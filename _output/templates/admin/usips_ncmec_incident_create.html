<xf:title>{{ phrase('usips_ncmec_create_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:radiorow name="incident_action" label="{{ phrase('usips_ncmec_incident') }}" value="new">
                <xf:option value="new" label="{{ phrase('usips_ncmec_create_new_incident') }}">
                    <xf:dependent>
                        <xf:textbox name="title" value="{$title}" label="{{ phrase('title') }}" />
                    </xf:dependent>
                </xf:option>
                <xf:option value="existing" label="{{ phrase('usips_ncmec_existing_incident') }}"
                    disabled="{{ !$existingIncidents }}">
                    <xf:dependent>
                        <xf:select name="existing_incident_id">
                            <xf:foreach loop="$existingIncidents" value="$incident">
                                <xf:option value="{$incident.incident_id}">{$incident.title} ({{
                                    date($incident.created_date) }})</xf:option>
                            </xf:foreach>
                        </xf:select>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:if is="$attachments">
            <div class="block-body">
                <xf:macro name="usips_ncmec_incident_create::attachment_user_list"
                    arg-attachmentsByUser="{$attachmentsByUser}" arg-users="{$users}"
                    arg-checked="{$attachmentsChecked}" />
            </div>
        </xf:if>

        <div class="block-body">
            <xf:checkbox name="confirm" label="{{ phrase('confirm_submission') }}" value="1" checked="{$confirm}" />
        </div>
        <xf:submitrow sticky="true">
            <xf:html>
                <xf:button type="submit" name="submit" value="1" icon="save">{{ phrase('save') }}</xf:button>
            </xf:html>
        </xf:submitrow>
    </div>
</xf:form>

<xf:macro name="attachment_user_list" arg-attachmentsByUser="!" arg-users="!" arg-checked="{{ [] }}">
    <xf:datalist data-xf-init="responsive-data-list">
        <xf:datarow rowtype="header">
            <xf:cell>
                <span class="u-pullRight">
                    <xf:checkbox standalone="true">
                        <xf:option check-all="< .dataList" label="{{ phrase('select_all') }}" />
                    </xf:checkbox>
                </span>
                {{ phrase('users') }}
            </xf:cell>
        </xf:datarow>
        <xf:foreach loop="$attachmentsByUser" value="$attachments" key="$userId">
            <xf:set var="$user" value="{$users.{$userId}}" />
            <tbody class="dataList-rowGroup">
                <xf:datarow rowtype="subsection" rowclass="dataList-row--noHover">
                    <xf:cell>
                        <span class="u-pullRight">
                            <xf:checkbox standalone="true" name="user_ids[]" value="{$userId}">
                                <xf:option check-all="< .dataList-rowGroup" label="{{ phrase('select_all') }}" />
                            </xf:checkbox>
                        </span>
                        <ul class="listInline listInline--bullet">
                            <li>
                                <xf:avatar user="$user" size="xxs" href="" /> {$user.username}
                            </li>
                            <li>
                                {{ phrase('Joined') }}
                                <xf:date time="$user.register_date" />
                            </li>
                        </ul>
                    </xf:cell>
                </xf:datarow>
                <xf:datarow rowclass="dataList-cell--collapsible dataList-row--noHover">
                    <xf:cell class=" dataList-cell--usips-attachmentList">
                        <xf:macro name="usips_ncmec_macros::attachment_list" arg-attachments="{$attachments}"
                            arg-checked="{$checked}" />
                    </xf:cell>
                </xf:datarow>
            </tbody>
        </xf:foreach>
    </xf:datalist>
</xf:macro>