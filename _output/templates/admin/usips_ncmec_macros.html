<xf:macro id="attachment_block" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:if is="$attachments is not empty">
		<div class="block-body">
			<xf:macro id="attachment_list" arg-attachments="{$attachments}" arg-checked="{$checked}"
				arg-incident="{$incident}" />
		</div>
		<xf:else />
		<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
	</xf:if>
</xf:macro>

<xf:macro id="attachment_list" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:css src="usips_ncmec.less" />
	<xf:js src="USIPS/NCMEC/attachment_browser.js" />
	<div class="usips-attachments">
		<xf:foreach loop="$attachments" value="$attachment">
			<span class="usips-attachment">
				<input type="checkbox" class="usips-attachmentCheckbox"
					id="usips_attachment_{$attachment.attachment_id}" name="attachment_ids[]"
					value="{{ $attachment.attachment_id }}" {{ in_array($attachment.attachment_id, $checked) ? 'checked'
					: '' }} />
				<label class="usips-attachmentLabel" for="usips_attachment_{$attachment.attachment_id}">
					<div class="usips-attachmentOverlay">
						<div class="usips-attachmentInfo">
							<ul>
								<li>
									{$attachment.content_type}
								</li>
								<xf:if is="$attachment.content_id == 0">
									<li>{{ phrase('draft') }}</li>
								</xf:if>
								<li>
									<xf:date time="{{ $attachment.Data.upload_date }}" />
								</li>
								<li>{$attachment.filename}</li>
							</ul>
						</div>
					</div>
					<xf:if is="$attachment.has_thumbnail">
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentThumbnail{{ $attachment.in_incident ? ' is-in-incident' : '' }}"
							style="background-image: url({$attachment.thumbnail_url})" alt="{$attachment.filename}">
						</a>
						<xf:elseif is="$attachment.is_audio" />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<xf:fa icon="fa-volume fa-4x" />
						</a>
						<xf:elseif is="$attachment.is_video" />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<video title="{$attachment.filename}" class="usips-attachmentVideo">
								<source src="{$attachment.direct_url}" />
							</video>
						</a>
						<xf:else />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<xf:fa icon="fa-file fa-4x" />
						</a>
				</label>
				</xf:if>
			</span>
		</xf:foreach>
	</div>
</xf:macro>

<xf:macro id="user_avatar_block" arg-users="{{ [] }}">
	<xf:if is="$users is not empty">
		<div class="block-body">
			<xf:macro name="usips_ncmec_macros::user_avatar_list" arg-users="{$users}" />
		</div>
	</xf:if>
</xf:macro>

<xf:macro id="user_avatar_list" arg-users="{{ [] }}">
	<div class="user-avatars">
		<xf:foreach loop="$users" value="$user">
			<xf:avatar user="$user.User" size="s" />
		</xf:foreach>
	</div>
</xf:macro>