<xf:title>{{ phrase('usips_ncmec_finalize_case') }}</xf:title>

<xf:form action="{{ link('ncmec-cases/finalize', $case) }}" ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:if is="$apiEnvironment == 'production'">
                <div class="block-rowMessage block-rowMessage--success">
                    {{phrase('usips_ncmec_environment_live') }}
                </div>
                <xf:else />
                <div class="block-rowMessage block-rowMessage--warning">
                    {{ phrase('usips_ncmec_environment_test') }}
                </div>
            </xf:if>

            <xf:inforow rowtype="confirm">
                {{ phrase('usips_ncmec_finalize_case_confirm_text', {'title': $case.title}) }}
            </xf:inforow>

            <xf:if is="$previews is not empty">
                <xf:foreach loop="$previews" value="$preview">
                    <h3 class="block-formSectionHeader">
                        <span class="block-formSectionHeader-aligner">
                            {{ phrase('usips_ncmec_report') }}: {$preview.user.username}
                        </span>
                    </h3>
                    <xf:if is="$preview.error">
                        <div class="block-row">
                            <div class="blockMessage blockMessage--error">{$preview.error}</div>
                        </div>
                        <xf:else />
                        <xf:codeeditorrow name="xml_preview_{$preview.user.user_id}" value="{$preview.xml}" mode="xml"
                            readonly="true" rowtype="fullWidth noLabel" />
                    </xf:if>
                </xf:foreach>
                <hr class="block-separator" />
            </xf:if>

            <xf:checkboxrow explain="{{ phrase('usips_ncmec_finalize_deletion_warning') }}">
                <xf:option name="confirm" value="1" label="{{ phrase('usips_ncmec_confirm_finalize_permanent') }}"
                    required="true" />
            </xf:checkboxrow>
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_finalize_case') }}" rowtype="simple" icon="save" />
    </div>
</xf:form>