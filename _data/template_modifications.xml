<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="approval_queue_macros" modification_key="usips_ncmec_approval_queue_macros" description="Adds viewable attachments with NCMEC incident response actions to the approval queue." execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<div class="message-expandLink js-expandLink">.*?<\/div>(.*?)<\/div>/s]]></find>
    <replace><![CDATA[$0

<xf:include template="usips_ncmec_approval_queue_macro_item_message_type" />]]></replace>
  </modification>
  <modification type="admin" template="attachment_list" modification_key="usips_ncmec_attachment_list" description="Adds clarity to where an unassociated file is attached." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[{{ phrase('unassociated') }}]]></find>
    <replace><![CDATA[{{ phrase('unassociated') }}
									<span class="dataList-secondRow">{$attachment.getContentTypePhrase()|parens}</span>]]></replace>
  </modification>
  <modification type="public" template="post_macros" modification_key="usips_ncmec_post_macros_report" description="Adds a report icon to the top of posts so it may be actioned without seeing the post." execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:if is="$showPosition">]]></find>
    <replace><![CDATA[<xf:macro template="usips_ncmec_post_macros" name="report_post" arg-post="{$post}" arg-thread="{$thread}" />

$0]]></replace>
  </modification>
  <modification type="public" template="report_view" modification_key="usips_ncmec_report_view" description="Adds the &quot;Flag as CSAM&quot; option to the Report view." execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/(<xf:radiorow[^>]*name="report_state"[^>]*>)(.*?)(<\/xf:radiorow>)/s]]></find>
    <replace><![CDATA[<xf:include template="usips_ncmec_report_state" />]]></replace>
  </modification>
  <modification type="public" template="report_view" modification_key="usips_ncmec_report_view_attachments" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[{$handler.render($report)|raw}]]></find>
    <replace><![CDATA[$0

<xf:include template="usips_ncmec_report_view_attachments" />]]></replace>
  </modification>
  <modification type="admin" template="user_batch_update_confirm" modification_key="usips_ncmec_user_batch_update_confirm" description="Adds the NCMEC Incident action to the User Batch Update Confirmation page." execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[#</xf:form>(?!.*</xf:form>)#s
]]></find>
    <replace><![CDATA[$0

<xf:include template="usips_ncmec_user_batch_update_confirm" />]]></replace>
  </modification>
</template_modifications>
