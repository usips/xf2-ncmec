<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="option_template_usipsNcmecApi" version_id="0" version_string="1.0.0"><![CDATA[<xf:formrow label="{$option.title}" hint="{$hintHtml}" explain="{$explainHtml}" rowclass="{$rowClass}">

	<xf:if is="!empty($option.option_value.username)">
		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('usips_ncmec_environment') }}</dt>
			<dd>
				{{ $option.option_value.environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
			</dd>
		</dl>

		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('user_name') }}</dt>
			<dd>{$option.option_value.username}</dd>
		</dl>

		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('password') }}</dt>
			<dd>********</dd>
		</dl>
		<xf:else />
		<div>{{ phrase('usips_ncmec_api_not_configured') }}</div>
	</xf:if>

	<div class="u-inputSpacer">
		<xf:button href="{{ link('ncmec/config') }}" data-xf-click="overlay">
			{{ !empty($option.option_value.username) ? phrase('change') : phrase('usips_ncmec_configure_api') }}
		</xf:button>
	</div>
</xf:formrow>]]></template>
  <template type="admin" title="usips_ncmec.less" version_id="0" version_string="1.0.0"><![CDATA[@_attach-thumbSize: xf-option('attachmentThumbnailDimensions', px);
@_bg-color: rgba(200, 200, 200, 0.25);
@_max-thumbSize: 300px;

.usips-attachments {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    background-image:
        linear-gradient(45deg, @_bg-color 25%, transparent 25%),
        linear-gradient(-45deg, @_bg-color 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, @_bg-color 75%),
        linear-gradient(-45deg, transparent 75%, @_bg-color 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;

    @media (max-width: 800px) {
        grid-template-columns: repeat(2, 1fr);
    }

    @media (max-width: 1200px) {
        grid-template-columns: repeat(3, 1fr);
    }

    .usips-attachment {
        position: relative;
        width: 100%;
        max-width: @_max-thumbSize;
        height: @_attach-thumbSize;
        overflow: hidden;
        justify-self: center;
    }

    .usips-attachmentCheckbox {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1;
    }

    .usips-attachmentCheckbox:checked+.usips-attachmentLabel {
        border: 2px solid red;
        background: rgba(255, 0, 0, 0.1);
        box-sizing: border-box;
    }

    .usips-attachmentLabel {
        display: block;
        background: rgba(0, 0, 255, 0.1);
        width: 100%;
        height: 100%;
        border: 2px solid transparent;
        box-sizing: border-box;

        &:hover .usips-attachmentOverlay {
            opacity: 1;
        }

        &.is-in-incident {
            border-color: orange;
            border-style: dashed;
        }
    }

    .usips-attachmentOverlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        transition: opacity 0.1s;
    }

    .usips-attachmentLink {
        display: block;
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        line-height: @_attach-thumbSize;
        text-align: center;
        text-decoration: none;
        overflow: hidden;
        pointer-events: none;

        .usips-attachmentVideo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            margin: auto;
        }

        .fa--xf {
            vertical-align: middle;
        }
    }
}

.dataList-cell--usips-attachmentList {
    padding: 0;
}]]></template>
  <template type="admin" title="usips_ncmec_attachment_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('attachment_browser') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
	<div class="block-container">
		<xf:macro name="filter_macros::filter_bar" arg-route="attachments" arg-content="{{ null }}"
			arg-params="{$linkParams}" arg-displayValues="{$filterDisplay}" arg-phrases="{{ {
				'key:content_type':  phrase('content_type:'),
				'key:username': phrase('user_name:'),
				'key:start': phrase('start_date:'),
				'key:end': phrase('end_date:'),
				'key:order': phrase('sort_by:'),
				'val:file_size_desc': phrase('largest'),
				'val:file_size_asc': phrase('smallest'),
				'val:attach_date_desc': phrase('most_recent'),
				'val:attach_date_asc': phrase('least_recent')
			} }}" arg-menu="attachments/filter" arg-menuTitle="{{ phrase('filter') }}" />

		<xf:if is="$attachments is not empty">
			<div class="block-body">
				<xf:macro name="usips_ncmec_macros::attachment_list" arg-attachments="{{ $attachments }}" />
			</div>
		</xf:if>
		<xf:submitrow sticky="true">
			<xf:html>
				<xf:button type="submit" name="submit" icon="siren">{{ phrase('usips_ncmec_create_incident') }}
				</xf:button>
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_attachment_lookup" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_lookup') }}</xf:title>

<div class="blockMessage">{{ phrase('usips_ncmec_lookup_guide') }}</div>

<xf:form action="{{ link('ncmec-attachments/lookup') }}" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:textarea name="input" rows="20" placeholder="{{ phrase('usips_ncmec_lookup_description') }}" />
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_lookup_submit') }}" fa="fa-file-search" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_attachment_lookup_results" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_lookup') }}</xf:title>

<xf:form action="{{ link('ncmec-attachments/lookup') }}" class="block">
    <div class="block-container">
        <h3 class="block-header">{{ phrase('usips_ncmec_failed_lines') }}</h3>
        <div class="block-body">
            <xf:textarea name="input" value="{{ $failedLines }}" rows="{{ $failedLinesCount }}" />
        </div>
    </div>
    <xf:submitrow sticky="true" type="submit" name="attachment_ids" icon="search" value="{{ $attachmentIds|join(',') }}"
        submit="{{ phrase('usips_ncmec_lookup_reattempt') }}">
        <xf:html>
            <xf:button type="submit" name="forget" icon="search">{{ phrase('usips_ncmec_lookup_restart') }}</xf:button>
        </xf:html>
    </xf:submitrow>
</xf:form>

<xf:if is="$attachments">
    <h3 class="block-header">{{ phrase('usips_ncmec_attachments') }}</h3>
    <xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
        <div class="block-container">
            <xf:macro name="usips_ncmec_macros::attachment_block" arg-attachments="{{ $attachments }}"
                arg-checked="{{ $attachmentIds }}" />
        </div>
        <xf:submitrow sticky="true" submit="{{ phrase('usips_ncmec_create_incident') }}" icon="siren"></xf:submitrow>
    </xf:form>
    <xf:else />
    <div class="blockMessage">{{ phrase('no_results_found') }}</div>
</xf:if>]]></template>
  <template type="admin" title="usips_ncmec_config" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_configure_api') }}</xf:title>

<xf:form action="{{ link('ncmec/config') }}" class="block" ajax="true">
    <div class="block-container">
		<div class="block-body">
			<xf:if is="!empty($xf.option.option_value.username)">
				<xf:formrow label="{{ phrase('option.usipsNcmecApi') }}" explain="{{ phrase('option_explain.usipsNcmecApi') }}" rowclass="{$rowClass}">

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('usips_ncmec_environment') }}</dt>
						<dd>
							{{ $option.option_value.environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
						</dd>
					</dl>

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('user_name') }}</dt>
						<dd>{$option.option_value.username}</dd>
					</dl>

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('password') }}</dt>
						<dd>********</dd>
					</dl>
				</xf:formrow>
			</xf:if>

            <xf:radiorow label="{{ phrase('usips_ncmec_environment') }}" rowtype="radio">
                <xf:option name="environment" value="test" checked="true">
                    {{ phrase('usips_ncmec_env_test') }}
                </xf:option>
                <xf:option name="environment" value="production">
                    {{ phrase('usips_ncmec_env_live') }}
                </xf:option>
            </xf:radiorow>

            <xf:formrow label="{{ phrase('usips_ncmec_esp_credentials') }}" rowtype="input"
                explain="{{ phrase('usips_ncmec_esp_credentials_explain') }}">
                <div class="inputGroup">
                    <xf:textbox name="username" placeholder="{{ phrase('user_name') }}" size="20" autocomplete="off" />
                    <span class="inputGroup-splitter"></span>
                    <xf:textbox type="password" name="password" placeholder="{{ phrase('password') }}" size="20"
                        autocomplete="new-password" />
                </div>
            </xf:formrow>
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_test_connection') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_config_confirm" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_configure_api') }}</xf:title>

<xf:form action="{{ link('ncmec/config/save') }}" class="block">
    <xf:hiddenval name="username">{$config.username}</xf:hiddenval>
    <xf:hiddenval name="password">{$config.password}</xf:hiddenval>
    <xf:hiddenval name="environment">{$config.environment}</xf:hiddenval>

    <div class="block-container">
        <div class="block-body">
            <div class="blockMessage blockMessage--success blockMessage--iconic">
                {{ phrase('usips_ncmec_connection_successful') }}
            </div>

            <xf:formrow label="{{ phrase('usips_ncmec_environment') }}">
                {{ $environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
            </xf:formrow>

            <xf:formrow label="{{ phrase('user_name') }}">
                {$config.username}
            </xf:formrow>
        </div>
        <xf:submitrow icon="save" submit="{{ phrase('usips_ncmec_save_configuration') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_dashboard" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_dashboard') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('ncmec/config') }}" icon="config" overlay="true">{{ phrase('usips_ncmec_configure_api') }}
	</xf:button>
</xf:pageaction>

<xf:if is="!$apiConfigured">
	<div class="blockMessage blockMessage--important blockMessage--iconic">
		{{ phrase('usips_ncmec_api_not_configured') }}
	</div>
<xf:elseif is="$connectionError" />
	<div class="blockMessage blockMessage--error blockMessage--iconic">
		{$connectionError}
	</div>
</xf:if>

<div class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_api_status') }}</h2>
		<div class="block-body">
			<xf:formrow label="{{ phrase('usips_ncmec_api_configured') }}">
				{{ $apiConfigured ? phrase('yes') : phrase('no') }}
			</xf:formrow>

			<xf:if is="$apiConfigured">
				<xf:formrow label="{{ phrase('usips_ncmec_environment') }}">
					{{ $environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
				</xf:formrow>
			</xf:if>
		</div>
	</div>
</div>

<div class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_quick_actions') }}</h2>
		<div class="block-body">
			<xf:formrow label="{{ phrase('enable_registration') }}" rowtype="button">
				{{ $xf.options.registrationSetup.enabled ? phrase('yes') : phrase('no') }}
				<xf:button href="{{ link('ncmec/registration/toggle') }}" class="button--link" data-xf-click="switch"
					data-sk-enable="{{ phrase('enable') }}" data-sk-disable="{{ phrase('disable') }}">
					{{ $xf.options.registrationSetup.enabled ? phrase('disable') : phrase('enable') }}
				</xf:button>
			</xf:formrow>

			<xf:if is="is_addon_active('Siropu/ReferralContests')">
				<xf:formrow label="{{ phrase('option.siropuReferralContestsInvitationOnly') }}" rowtype="button">
					{{ $xf.options.siropuReferralContestsInvitationOnly ? phrase('yes') : phrase('no') }}
					<xf:button href="{{ link('ncmec/invite-only/toggle') }}" class="button--link" data-xf-click="switch"
						data-sk-enable="{{ phrase('enable') }}" data-sk-disable="{{ phrase('disable') }}">
						{{ $xf.options.siropuReferralContestsInvitationOnly ? phrase('disable') : phrase('enable') }}
					</xf:button>
				</xf:formrow>
			</xf:if>
		</div>
	</div>
</div>

<xf:macro id="usips_ncmec_macros::incident_list_block" arg-incidents="{$incidents}" arg-nav="{{ false }}" arg-header="{{ true }}" />

<xf:macro id="usips_ncmec_macros::report_list_block" arg-incidents="{$reports}" arg-nav="{{ false }}" arg-header="{{ true }}" />]]></template>
  <template type="admin" title="usips_ncmec_incident_create" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_create_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:textboxrow name="title" value="{$title}" label="{{ phrase('title') }}" />
        </div>

        <xf:if is="$attachments">
            <div class="block-body">
                <xf:macro name="usips_ncmec_incident_create::attachment_user_list"
                    arg-attachmentsByUser="{$attachmentsByUser}" arg-users="{$users}"
                    arg-checked="{$attachmentsChecked}" />
            </div>
        </xf:if>

        <div class="block-body">
            <xf:checkbox name="confirm" label="{{ phrase('confirm_submission') }}" value="1" checked="{$confirm}" />
        </div>
        <xf:submitrow sticky="true">
            <xf:html>
                <xf:button type="submit" name="submit" value="1" icon="save">{{ phrase('save') }}</xf:button>
            </xf:html>
        </xf:submitrow>
    </div>
</xf:form>

<xf:macro name="attachment_user_list" arg-attachmentsByUser="!" arg-users="!" arg-checked="{{ [] }}">
    <xf:datalist data-xf-init="responsive-data-list">
        <xf:foreach loop="$attachmentsByUser" value="$attachments" key="$userId">
            <xf:set var="$user" value="{$users.{$userId}}" />
            <tbody class="dataList-rowGroup">
                <xf:datarow rowtype="subsection" rowclass="dataList-row--noHover">
                    <xf:cell>
                        <span class="u-pullRight">
                            <xf:checkbox standalone="true" name="user_ids[]" value="{$userId}">
                                <xf:option check-all="< .dataList-rowGroup" label="{{ phrase('select_all') }}" />
                            </xf:checkbox>
                        </span>
                        <ul class="listInline listInline--bullet">
                            <li>
                                <xf:avatar user="$user" size="xxs" href="" /> {$user.username}
                            </li>
                            <li>
                                {{ phrase('Joined') }}
                                <xf:date time="$user.register_date" />
                            </li>
                        </ul>
                    </xf:cell>
                </xf:datarow>
                <xf:datarow rowclass="dataList-cell--collapsible dataList-row--noHover">
                    <xf:cell class=" dataList-cell--usips-attachmentList">
                        <xf:macro name="usips_ncmec_macros::attachment_list" arg-attachments="{$attachments}"
                            arg-checked="{$checked}" />
                    </xf:cell>
                </xf:datarow>
            </tbody>
        </xf:foreach>
    </xf:datalist>
</xf:macro>]]></template>
  <template type="admin" title="usips_ncmec_incident_delete" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_confirm_incident_deletion') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/delete', $incident) }}" class="block">

    <div class="block-container">
        <div class="block-header">
            <h2 class="block-tabHeader">{{ phrase('usips_ncmec_confirm_incident_deletion') }}</h2>
        </div>

        <div class="block-body">
            <xf:if is="$incident.is_finalized">
                <xf:inforow rowtype="error">
                    {{ phrase('usips_ncmec_incident_finalized_cannot_delete') }}
                </xf:inforow>
                <xf:else />
                <xf:inforow rowtype="confirm">
                    {{ phrase('please_confirm_that_you_want_to_delete_following:') }}
                    <strong><a href="{{ link('ncmec-incidents/edit', $incident) }}">{$incident.title}</a></strong>
                </xf:inforow>

                <xf:submitrow submit="{{ phrase('delete') }}" />
            </xf:if>
        </div>
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incidents') }}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('ncmec-incidents/create') }}" icon="add">
        {{ phrase('usips_ncmec_create_incident') }}
    </xf:button>
</xf:pageaction>

<xf:macro id="usips_ncmec_macros::incident_list_block" arg-incidents="{$incidents}" />]]></template>
  <template type="admin" title="usips_ncmec_incident_user_content" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incident_user') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-incidents/view', $incident) }}">{$incident.title}</xf:breadcrumb>

<xf:pageaction if="true">
	<xf:button href="{{ link('ncmec-incidents/user/delete', $incidentUser) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('ncmec-incidents/user/associate-timestamp', $incidentUser) }}" ajax="true" class="block">
	<div class="block-container">
			<xf:formrow label="{{ phrase('usips_ncmec_content_time_limit') }}"
				explain="{{ phrase('usips_ncmec_content_time_limit_explain') }}">
				<xf:select name="time_limit_seconds">
					<xf:option value="-1" selected="{{ $timeLimitSelection == -1 }}">{{ phrase('usips_ncmec_use_default_timespan', {'duration': $timeLimitDefaultDescription ?: phrase('all_time')}) }}</xf:option>
					<xf:option value="3600" selected="{{ $timeLimitSelection == 3600 }}">{{ phrase('1_hour') }}</xf:option>
					<xf:option value="86400" selected="{{ $timeLimitSelection == 86400 }}">{{ phrase('1_day') }}</xf:option>
					<xf:option value="172800" selected="{{ $timeLimitSelection == 172800 }}">{{ phrase('x_hours', {'count': 48}) }}</xf:option>
					<xf:option value="604800" selected="{{ $timeLimitSelection == 604800 }}">{{ phrase('1_week') }}</xf:option>
					<xf:option value="2592000" selected="{{ $timeLimitSelection == 2592000 }}">{{ phrase('1_month') }}</xf:option>
					<xf:option value="0" selected="{{ $timeLimitSelection == 0 }}">{{ phrase('all_time') }}</xf:option>
				</xf:select>
			</xf:formrow>
		<xf:submitrow>
			<xf:html>
				<xf:button type="submit" name="submit" icon="attach">{{ phrase('usips_ncmec_associate') }}
				</xf:button>
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>

<xf:form action="{{ link('ncmec-incidents/user/update-attachments', $incidentUser) }}" ajax="true" class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_attachments') }}</h2>
		<xf:if is="$availableAttachments is not empty">
			<div class="block-body">
				<xf:macro name="usips_ncmec_macros::attachment_block" arg-incident="{$incident}"
					arg-attachments="{$availableAttachments}" arg-checked="{$associatedAttachmentIds}" />
			</div>
			<xf:else />
			<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
		</xf:if>
		<xf:submitrow sticky="true">
			<xf:html>
				<xf:button type="submit" name="submit" icon="save">{{ phrase('save') }}
				</xf:button>
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_user_delete" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_remove_user_from_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/user/delete', $incidentUser) }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body block-row">
            {{ phrase('usips_ncmec_remove_user_from_incident_confirm', {
            'user': $user.username,
            'incident': $incident.title
            }) }}
        </div>
        <xf:submitrow icon="delete" submit="{{ phrase('usips_ncmec_remove_user') }}" sticky="true" />
    </div>
    <xf:hiddenval name="_xfRedirect">{{ link('ncmec-incidents/view', $incident) }}</xf:hiddenval>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incident') }}</xf:title>

<xf:pageaction if="true">
    <xf:button href="{{ link('ncmec-incidents/delete', $incident) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('ncmec-incidents/update', $incident) }}" ajax="true" class="block">

    <div class="block-container">
        <div class="block-body">
            <xf:textboxrow name="title" value="{$incident.title}" label="{{ phrase('title') }}" />
            <xf:textarearow name="additional_info" value="{$incident.additional_info}"
                label="{{ phrase('usips_ncmec_additional_info') }}"
                explain="{{ phrase('usips_ncmec_additional_info_explain') }}" rows="10" />

            <xf:formrow label="{{ phrase('usips_ncmec_incident_status') }}">
                <xf:if is="$incident.is_finalized">
                    {{ phrase('usips_ncmec_incident_finalized') }}
                    <xf:else />
                    {{ phrase('usips_ncmec_incident_draft') }}
                </xf:if>
            </xf:formrow>

            <xf:formrow label="{{ phrase('usips_ncmec_associated_users') }}">
                {{ $counts.users|number }}
            </xf:formrow>
            <xf:formrow label="{{ phrase('usips_ncmec_associated_content') }}">
                {{ $counts.content|number }}
            </xf:formrow>
            <xf:formrow label="{{ phrase('usips_ncmec_associated_attachment_data') }}">
                {{ $counts.attachments|number }}
            </xf:formrow>

            <xf:submitrow sticky="true" icon="save" />
        </div>
    </div>
</xf:form>

<xf:macro name="usips_ncmec_macros::user_avatar_list" arg-users="{$incident.IncidentUsers}" arg-incident="{$incident}" />]]></template>
  <template type="admin" title="usips_ncmec_macros" version_id="0" version_string="1.0.0"><![CDATA[<xf:macro id="attachment_block" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:if is="$attachments is not empty">
		<div class="block-body">
			<xf:macro id="attachment_list" arg-attachments="{$attachments}" arg-checked="{$checked}"
				arg-incident="{$incident}" />
		</div>
		<xf:else />
		<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
	</xf:if>
</xf:macro>

<xf:macro id="attachment_list" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:css src="usips_ncmec.less" />
	<xf:js src="USIPS/NCMEC/attachment_browser.js" />
	<div class="usips-attachments">
		<xf:foreach loop="$attachments" value="$attachment">
			<span class="usips-attachment">
				<input type="checkbox" class="usips-attachmentCheckbox"
					id="usips_attachment_{$attachment.attachment_id}" name="attachment_ids[]"
					value="{{ $attachment.attachment_id }}" {{ in_array($attachment.attachment_id, $checked) ? 'checked' : '' }} />
				<label class="usips-attachmentLabel" for="usips_attachment_{$attachment.attachment_id}">
					<div class="usips-attachmentOverlay">
						<div class="usips-attachmentInfo">
							<ul>
								<li>{$attachment.content_type}</li>
								<xf:if is="$attachment.content_id == 0">
									<li>{{ phrase('draft') }}</li>
								</xf:if>
								<li>
									<xf:date time="{{ $attachment.Data.upload_date }}" />
								</li>
								<li>{$attachment.filename}</li>
							</ul>
						</div>
					</div>
					<xf:if is="$attachment.has_thumbnail">
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentThumbnail{{ $attachment.in_incident ? ' is-in-incident' : '' }}"
							style="background-image: url({$attachment.thumbnail_url})" alt="{$attachment.filename}">
						</a>
						<xf:elseif is="$attachment.is_audio" />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<xf:fa icon="fa-volume fa-4x" />
						</a>
						<xf:elseif is="$attachment.is_video" />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<video title="{$attachment.filename}" class="usips-attachmentVideo">
								<source src="{$attachment.direct_url}" />
							</video>
						</a>
						<xf:else />
						<a href="{{ link('attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon{{ $attachment.in_incident ? ' is-in-incident' : '' }}">
							<xf:fa icon="fa-file fa-4x" />
						</a>
					</xf:if>
				</label>
			</span>
		</xf:foreach>
	</div>
</xf:macro>

<xf:macro id="incident_list" arg-incidents="{{ [] }}">
	<xf:datalist class="dataList">
		<xf:datarow rowtype="header">
			<xf:cell>{{ phrase('title') }}</xf:cell>
			<xf:cell>{{ phrase('user') }}</xf:cell>
			<xf:cell>{{ phrase('date') }}</xf:cell>
			<xf:cell>{{ phrase('status') }}</xf:cell>
			<xf:cell></xf:cell>
			<xf:cell></xf:cell>
		</xf:datarow>
		<xf:foreach loop="$incidents" value="$incident">
			<xf:datarow>
				<xf:cell>
					<a href="{{ link('ncmec-incidents/view', $incident) }}">
						{{ $incident.title ?: phrase('usips_ncmec_untitled_incident') }}
					</a>
				</xf:cell>
				<xf:cell>
					<xf:avatar user="$incident.User" size="xxs" />
					<xf:username user="$incident.User" />
				</xf:cell>
				<xf:cell>
					<xf:date time="$incident.created_date" />
				</xf:cell>
				<xf:cell>
					<xf:if is="$incident.is_finalized">
						{{ phrase('usips_ncmec_incident_finalized') }}
						<xf:else />
						{{ phrase('usips_ncmec_incident_draft') }}
					</xf:if>
				</xf:cell>
				<xf:action class="{{ false ? 'dataList-cell--highlighted' : '' }}"
						   href="{{ link('ncmec-incidents/log', $incident) }}">
					{{ phrase('usips_ncmec_report_logs') }}
				</xf:action>
				<xf:delete href="{{ link('ncmec-incidents/delete', $incident) }}" />
			</xf:datarow>
		</xf:foreach>
	</xf:datalist>
</xf:macro>

<xf:macro id="incident_list_block" arg-incidents="{{ [] }}" arg-header="{{ false }}" arg-nav="{{ true }}">
	<div class="block">
		<div class="block-container">
			<xf:if is="{$header}">
				<h2 class="block-header">{{ phrase('usips_ncmec_incidents') }}</h2>
			</xf:if>
			<xf:if is="$incidents is not empty">
				<div class="block-body">
					<xf:macro id="incident_list" arg-incidents="{{ $incidents }}" />
				</div>

				<xf:pagenav page="$page" perpage="$perPage" total="$total" link="ncmec-incidents" />
			<xf:else />
				<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
		</div>
	</div>
</xf:macro>

<xf:macro id="report_list" arg-incidents="{{ [] }}">

</xf:macro>

<xf:macro id="report_list_block" arg-reports="{{ [] }}" arg-header="{{ false }}" arg-nav="{{ true }}">
	<div class="block">
		<div class="block-container">
				<xf:if is="{$header}">
					<h2 class="block-header">{{ phrase('usips_ncmec_reports') }}</h2>
				</xf:if>
			<xf:if is="$reports is not empty">
				<div class="block-body">
					<xf:macro id="report_list" arg-incidents="{$reports}" />
				</div>

				<xf:pagenav page="$page" perpage="$perPage" total="$total" link="ncmec-reports" />
			<xf:else />
				<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
		</div>
	</div>
</xf:macro>

<xf:macro id="user_avatar_block" arg-users="{{ [] }}" arg-incident="{{ false }}">
	<xf:if is="$users is not empty">
		<div class="block-body">
			<xf:macro name="usips_ncmec_macros::user_avatar_list" arg-users="{$users}" arg-incident="{$incident}" />
		</div>
	</xf:if>
</xf:macro>

<xf:macro id="user_avatar_list" arg-users="{{ [] }}" arg-incident="{{ false }}">
	<div class="user-avatars">
		<xf:foreach loop="$users" value="$user">
			<xf:avatar user="$user.User" size="s" href="{{ $incident ? link('ncmec-incidents/user', $user) : '' }}"/>
		</xf:foreach>
	</div>
</xf:macro>]]></template>
  <template type="admin" title="usips_ncmec_user_batch_update_confirm" version_id="0" version_string="1.0.0"><![CDATA[<xf:form action="{{ link('users/batch-update/action') }}" class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_create_incident') }}</h2>
		<div class="block-body">
			<xf:checkboxrow>
				<xf:option name="actions[ncmec_incident]" required="{{ true }}">{{
					phrase('usips_ncmec_confirm_associating_x_users',
					{'total':
					$total|number}) }}</xf:option>
			</xf:checkboxrow>

			<xf:formrow label="{{ phrase('usips_ncmec_incident') }}">
				<xf:if is="$nonFinalizedIncidents is not empty">
					<xf:select name="incident_id">
						<xf:option value="">{{ phrase('usips_ncmec_create_incident') }}</xf:option>
						<xf:foreach loop="$nonFinalizedIncidents" value="$incident">
							<xf:option value="{$incident.incident_id}">{$incident.title} ({{
								date($incident.created_date) }})</xf:option>
						</xf:foreach>
					</xf:select>
					<xf:else />
					{{ phrase('usips_ncmec_new_incident_will_be_created') }}
				</xf:if>
			</xf:formrow>

			<xf:formrow label="{{ phrase('usips_ncmec_content_time_limit') }}"
				explain="{{ phrase('usips_ncmec_content_time_limit_explain_batch') }}">
				<xf:set var="$selection">{{ $timeLimitSelection ?? -1 }}</xf:set>
				<xf:set var="$defaultDescription">{{ $timeLimitDefaultDescription ?? phrase('all_time') }}</xf:set>
				<xf:select name="time_limit_seconds">
					<xf:option value="-1" selected="{{ $selection == -1 }}">{{ phrase('usips_ncmec_use_default_timespan', {'duration': $defaultDescription}) }}</xf:option>
					<xf:option value="3600" selected="{{ $selection == 3600 }}">{{ phrase('1_hour') }}</xf:option>
					<xf:option value="86400" selected="{{ $selection == 86400 }}">{{ phrase('1_day') }}</xf:option>
					<xf:option value="172800" selected="{{ $selection == 172800 }}">{{ phrase('48_hours') }}</xf:option>
					<xf:option value="604800" selected="{{ $selection == 604800 }}">{{ phrase('1_week') }}</xf:option>
					<xf:option value="2592000" selected="{{ $selection == 2592000 }}">{{ phrase('1_month') }}</xf:option>
					<xf:option value="0" selected="{{ $selection == 0 }}">{{ phrase('all_time') }}</xf:option>
				</xf:select>
			</xf:formrow>
		</div>
		<xf:submitrow name="ncmec_incident" icon="attach" submit="{{ phrase('usips_ncmec_associate_users') }}" />
	</div>

	<xf:if is="$userIds">
		<xf:hiddenval name="user_ids">{$userIds|json}</xf:hiddenval>
		<xf:else />
		<xf:hiddenval name="criteria">{$criteria|json}</xf:hiddenval>
	</xf:if>
</xf:form>]]></template>
  <template type="public" title="alert_report_emergency" version_id="0" version_string="1.0.0"><![CDATA[{{ phrase('usips_ncmec_x_created_emregency_report_y', {
	'name': username_link($user, false, {'defaultname': $alert.username}),
	'title': '<a href="' . link('reports', $content) . '#report-comment-' . $alert.extra_data.comment.report_comment_id . '" class="fauxBlockLink-blockLink">' . $content.title . '</a>'
}) }}]]></template>
  <template type="public" title="usips_ncmec_approval_queue_macro_item_message_type" version_id="0" version_string="1.0.0"><![CDATA[<xf:macro id="message_macros::attachments" arg-attachments="{{ $content.Attachments }}" arg-message="{{ $content }}" arg-canView="{{ true }}" />]]></template>
  <template type="public" title="usips_ncmec_report_create" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('report_content') }}</xf:title>

<xf:form action="{$confirmUrl}" class="block" ajax="true" data-skip-overlay-redirect="true">

	<div class="block-container">
		<div class="block-body">
			<xf:radiorow name="report_type" value="standard" label="{{ phrase('usips_ncmec_report_type') }}"
				required="true" explain="{{ phrase('usips_ncmec_report_type_explain') }}">
				<xf:option value="standard" selected="true" label="{{ phrase('usips_ncmec_report_type_standard') }}">
					<xf:dependent>
						<div class="inputGroup">
							<xf:textarea name="message" autosize="true" autofocus="autofocus"
								placeholder="{{ phrase('report_reason') }}" />
						</div>
					</xf:dependent>
				</xf:option>
				<xf:option value="emergency" label="{{ phrase('usips_ncmec_report_type_emergency') }}" />
			</xf:radiorow>
		</div>
		<xf:submitrow submit="{{ phrase('report_verb') }}" />
	</div>
</xf:form>]]></template>
  <template type="public" title="usips_ncmec_report_state" version_id="0" version_string="1.0.0"><![CDATA[<xf:radiorow name="report_state" label="{{ phrase('status') }}">
	<xf:option value="" label="{{ phrase('do_not_change') }}" selected="true" />
	<xf:option value="assigned" label="{{ $report.report_state == 'assigned' ? phrase('unassign') : phrase('report_state.assigned') }}" />
	<xf:option value="resolved" label="{{ phrase('report_state.resolved') }}" />
	<xf:option value="rejected" label="{{ phrase('report_state.rejected') }}" />
	<xf:option value="flag_as_csam" label="{{ phrase('report_state.flag_as_csam') }}" />
</xf:radiorow>]]></template>
</templates>
