<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="option_template_usipsNcmecApi" version_id="0" version_string="1.0.0"><![CDATA[<xf:formrow label="{$option.title}" hint="{$hintHtml}" explain="{$explainHtml}" rowclass="{$rowClass}">

	<xf:if is="!empty($option.option_value.username)">
		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('usips_ncmec_environment') }}</dt>
			<dd>
				{{ $option.option_value.environment === 'production' ? phrase('usips_ncmec_env_live') :
				phrase('usips_ncmec_env_test') }}
			</dd>
		</dl>

		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('user_name') }}</dt>
			<dd>{$option.option_value.username}</dd>
		</dl>

		<dl class="pairs pairs--columns pairs--fixedSmall">
			<dt>{{ phrase('password') }}</dt>
			<dd>********</dd>
		</dl>
		<xf:else />
		<div>{{ phrase('usips_ncmec_api_not_configured') }}</div>
	</xf:if>

	<div class="u-inputSpacer">
		<xf:button href="{{ link('ncmec/config') }}" data-xf-click="overlay">
			{{ !empty($option.option_value.username) ? phrase('change') : phrase('usips_ncmec_configure_api') }}
		</xf:button>
	</div>
</xf:formrow>]]></template>
  <template type="admin" title="usips_ncmec.less" version_id="0" version_string="1.0.0"><![CDATA[@_attach-thumbSize: xf-option('attachmentThumbnailDimensions', px);
@_bg-color: rgba(200, 200, 200, 0.25);
@_max-thumbSize: 300px;

.usips-attachments {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    background-image:
        linear-gradient(45deg, @_bg-color 25%, transparent 25%),
        linear-gradient(-45deg, @_bg-color 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, @_bg-color 75%),
        linear-gradient(-45deg, transparent 75%, @_bg-color 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;

    @media (max-width: 800px) {
        grid-template-columns: repeat(2, 1fr);
    }

    @media (max-width: 1200px) {
        grid-template-columns: repeat(3, 1fr);
    }

    .usips-attachment {
        position: relative;
        width: 100%;
        max-width: @_max-thumbSize;
        height: @_attach-thumbSize;
        overflow: hidden;
        justify-self: center;
    }

    .usips-attachment--inIncident {
        background: rgba(255, 0, 0, 0.1);
    }

    .usips-attachmentCheckbox {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1;
    }

    .usips-attachmentCheckbox:checked+.usips-attachmentLabel {
        border: 2px solid red;
        background: rgba(255, 0, 0, 0.1);
        box-sizing: border-box;
    }

    .usips-attachmentLabel {
        display: block;
        background: rgba(0, 0, 255, 0.1);
        width: 100%;
        height: 100%;
        border: 2px solid transparent;
        box-sizing: border-box;
        position: relative;

        &:hover .usips-attachmentOverlay {
            opacity: 1;
        }
    }

    .usips-attachmentIndicator {
        position: absolute;
        top: 5px;
        right: 5px;
        z-index: 5;
        background: white;
        color: #D32F2F;
        /* Red 700 */
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        font-size: 12px;
    }

    .usips-attachmentOverlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        opacity: 0;
        transition: opacity 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        z-index: 10;
        pointer-events: none;
        /* Allow clicking through to the link/checkbox if needed, but we have links inside */

        /* Enable pointer events for the content so links work */
        .usips-attachmentInfo {
            pointer-events: auto;
            width: 100%;
            max-height: 100%;
            overflow-y: auto;
            color: #f0f0f0;
            font-size: 11px;
            text-align: center;

            ul {
                list-style: none;
                padding: 0;
                margin: 0;

                li {
                    margin-bottom: 4px;
                    word-wrap: break-word;

                    &:last-child {
                        margin-bottom: 0;
                    }
                }
            }

            a {
                color: #64B5F6;
                text-decoration: none;

                &:hover {
                    text-decoration: underline;
                }
            }

            .usips-attachmentInfo-label {
                color: #999;
                font-size: 10px;
                text-transform: uppercase;
            }
        }
    }

    .usips-attachmentLink {
        display: block;
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        line-height: @_attach-thumbSize;
        text-align: center;
        text-decoration: none;
        overflow: hidden;
        pointer-events: none;

        .usips-attachmentVideo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            margin: auto;
        }

        .fa--xf {
            vertical-align: middle;
        }
    }
}

.dataList-cell--usips-attachmentList {
    padding: 0;
}]]></template>
  <template type="admin" title="usips_ncmec_api_log_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_api_logs') }}</xf:title>

<div class="block">
    <div class="block-container">
        <h2 class="block-tabHeader tabs hScroller" data-xf-init="h-scroller">
            <span class="hScroller-scroll">
                <xf:foreach loop="$tabs" key="$tabState" value="$tabLabel">
                    <a href="{{ link('ncmec-api-logs', null, {'state': $tabState}) }}"
                        class="tabs-tab {{ $tabState == $state ? 'is-active' : '' }}">{$tabLabel}</a>
                </xf:foreach>
            </span>
        </h2>

        <xf:if is="$logs.count()">
            <div class="block-body">
                <div class="structItemContainer">
                    <xf:macro template="usips_ncmec_macros" name="api_log_list" arg-logs="{$logs}" />
                </div>
            </div>

            <xf:else />
            <div class="block-body">
                <div class="blockMessage">{{ phrase('no_items_to_display') }}</div>
            </div>
        </xf:if>
    </div>
    <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}" link="ncmec-api-logs"
        wrapperclass="block-outer block-outer--after" />
</div>]]></template>
  <template type="admin" title="usips_ncmec_api_log_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_report_logs') }}</xf:title>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">{{ phrase('details') }}</h2>
        <div class="block-body">
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>{{ phrase('date') }}</dt>
                <dd>
                    <xf:date time="{$log.request_date}" />
                </dd>
            </dl>
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>{{ phrase('usips_ncmec_environment') }}</dt>
                <dd>
                    {{ $log.environment === 'production' ? phrase('usips_ncmec_env_live') :
                    phrase('usips_ncmec_env_test') }}
                </dd>
            </dl>
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>{{ phrase('status') }}</dt>
                <dd>
                    <xf:if is="$log.success">
                        <span class="label label--success">{{ phrase('success') }}</span>
                        <xf:else />
                        <span class="label label--accent">Failed</span>
                    </xf:if>
                    <xf:if is="$log.response_code">
                        <div class="u-muted">HTTP {$log.response_code}</div>
                    </xf:if>
                </dd>
            </dl>
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>Method</dt>
                <dd>{$log.request_method|to_upper}</dd>
            </dl>
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>Endpoint / URL</dt>
                <dd>
                    <div>{{ $log.request_endpoint ?: $log.request_url }}</div>
                    <xf:if is="$log.request_endpoint && $log.request_url">
                        <div class="u-muted">{$log.request_url}</div>
                    </xf:if>
                </dd>
            </dl>
            <dl class="pairs pairs--rows pairs--rows--fluid">
                <dt>{{ phrase('usips_ncmec_reporter') }}</dt>
                <dd>
                    <xf:if is="$log.User">
                        <xf:avatar user="{$log.User}" size="xxs" />
                        <xf:username user="{$log.User}" />
                        <xf:else />
                        {{ phrase('n_a') }}
                    </xf:if>
                </dd>
            </dl>
            <xf:if is="$log.Report">
                <dl class="pairs pairs--rows pairs--rows--fluid">
                    <dt>{{ phrase('usips_ncmec_report') }}</dt>
                    <dd>
                        <a href="{{ link('ncmec-reports/view', $log.Report) }}" target="_blank" rel="noopener">
                            {{ phrase('usips_ncmec_report_id') }}: {{ $log.Report.ncmec_report_id ?: phrase('n_a') }}
                        </a>
                    </dd>
                </dl>
                <xf:if is="$log.Report.Case">
                    <dl class="pairs pairs--rows pairs--rows--fluid">
                        <dt>{{ phrase('usips_ncmec_case') }}</dt>
                        <dd>
                            <a href="{{ link('ncmec-cases/view', $log.Report.Case) }}" target="_blank" rel="noopener">
                                {{ $log.Report.Case.title ?: phrase('usips_ncmec_untitled_case') }}
                            </a>
                        </dd>
                    </dl>
                </xf:if>
            </xf:if>
        </div>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">Response</h2>
        <div class="block-body">
            <xf:codeeditorrow name="response_body"
                value="{{ $responseBody !== '' ? $responseBody : ('// ' . phrase('n_a')) }}" mode="{$responseMode}"
                readonly="true" rowtype="fullWidth noLabel" />
        </div>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">Request</h2>
        <div class="block-body">
            <xf:codeeditorrow name="request_body"
                value="{{ $requestBody !== '' ? $requestBody : ('// ' . phrase('n_a')) }}" mode="{$requestMode}"
                readonly="true" rowtype="fullWidth noLabel" />
        </div>
    </div>
</div>]]></template>
  <template type="admin" title="usips_ncmec_attachment_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('attachment_browser') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
	<div class="block-container">
		<xf:macro name="filter_macros::filter_bar" arg-route="attachments" arg-content="{{ null }}"
			arg-params="{$linkParams}" arg-displayValues="{$filterDisplay}" arg-phrases="{{ {
				'key:content_type':  phrase('content_type:'),
				'key:username': phrase('user_name:'),
				'key:start': phrase('start_date:'),
				'key:end': phrase('end_date:'),
				'key:order': phrase('sort_by:'),
				'val:file_size_desc': phrase('largest'),
				'val:file_size_asc': phrase('smallest'),
				'val:attach_date_desc': phrase('most_recent'),
				'val:attach_date_asc': phrase('least_recent')
			} }}" arg-menu="attachments/filter" arg-menuTitle="{{ phrase('filter') }}" />

		<xf:if is="$attachments is not empty">
			<div class="block-body">
				<xf:macro name="usips_ncmec_macros::attachment_list" arg-attachments="{{ $attachments }}" />
			</div>
		</xf:if>
		<xf:submitrow sticky="true">
			<xf:html>
				<xf:button type="submit" name="submit" icon="siren">{{ phrase('usips_ncmec_create_incident') }}
				</xf:button>
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_attachment_lookup" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_lookup') }}</xf:title>

<div class="blockMessage">{{ phrase('usips_ncmec_lookup_guide') }}</div>

<xf:form action="{{ link('ncmec-attachments/lookup') }}" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:textarea name="input" rows="20" placeholder="{{ phrase('usips_ncmec_lookup_description') }}" />
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_lookup_submit') }}" fa="fa-file-search" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_attachment_lookup_results" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_lookup') }}</xf:title>

<xf:form action="{{ link('ncmec-attachments/lookup') }}" class="block">
    <div class="block-container">
        <h3 class="block-header">{{ phrase('usips_ncmec_failed_lines') }}</h3>
        <div class="block-body">
            <xf:textarea name="input" value="{{ $failedLines }}" rows="{{ $failedLinesCount }}" />
        </div>
    </div>
    <xf:submitrow sticky="true" type="submit" name="attachment_ids" icon="search" value="{{ $attachmentIds|join(',') }}"
        submit="{{ phrase('usips_ncmec_lookup_reattempt') }}">
        <xf:html>
            <xf:button type="submit" name="forget" icon="search">{{ phrase('usips_ncmec_lookup_restart') }}</xf:button>
        </xf:html>
    </xf:submitrow>
</xf:form>

<xf:if is="$attachments">
    <h3 class="block-header">{{ phrase('usips_ncmec_attachments') }}</h3>
    <xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
        <div class="block-container">
            <xf:macro name="usips_ncmec_macros::attachment_block" arg-attachments="{{ $attachments }}"
                arg-checked="{{ $attachmentIds }}" />
        </div>
        <xf:submitrow sticky="true" submit="{{ phrase('usips_ncmec_create_incident') }}" icon="siren"></xf:submitrow>
    </xf:form>
    <xf:else />
    <div class="blockMessage">{{ phrase('no_results_found') }}</div>
</xf:if>]]></template>
  <template type="admin" title="usips_ncmec_case_create" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_create_case') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-cases') }}">{{ phrase('usips_ncmec_cases') }}</xf:breadcrumb>

<xf:form action="{{ link('ncmec-cases/create') }}" ajax="true" class="block">
    <div class="block-container">
        <h3 class="block-header">{{ phrase('usips_ncmec_select_incidents_for_case') }}</h3>

        <xf:if is="$incidents is not empty">
            <div class="block-body">
                <xf:datalist class="dataList">
                    <xf:datarow rowtype="header">
                        <xf:cell></xf:cell>
                        <xf:cell>{{ phrase('title') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell>{{ phrase('date') }}</xf:cell>
                    </xf:datarow>
                    <xf:foreach loop="$incidents" value="$incident">
                        <xf:datarow>
                            <xf:toggle name="incident_ids[]" value="{$incident.incident_id}"
                                checked="{{ in_array($incident.incident_id, $preSelectedIds) }}" />

                            <xf:cell class="dataList-cell--link">
                                <a href="{{ link('ncmec-incidents/view', $incident) }}">
                                    {{ $incident.title ?: phrase('usips_ncmec_untitled_incident') }}
                                </a>
                            </xf:cell>
                            <xf:cell>
                                <xf:avatar user="$incident.User" size="xxs" />
                                <xf:username user="$incident.User" />
                            </xf:cell>
                            <xf:cell>
                                <xf:date time="$incident.created_date" />
                            </xf:cell>
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
            </div>

            <div class="block-footer block-footer--split">
                <span class="block-footer-select">
                    <xf:checkbox standalone="true">
                        <xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" />
                    </xf:checkbox>
                </span>
            </div>

            <xf:submitrow sticky="true" submit="{{ phrase('usips_ncmec_create_case') }}" icon="save" />
            <xf:else />
            <div class="block-body">
                <div class="blockMessage">{{ phrase('usips_ncmec_no_open_incidents') }}</div>
            </div>
        </xf:if>
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_case_delete" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('ncmec-cases/delete', $case) }}" ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:inforow rowtype="confirm">
                {{ phrase('please_confirm_that_you_want_to_delete_following:') }}
                <strong>{$case.title}</strong>
            </xf:inforow>
            <xf:inforow rowtype="warning">
                {{ phrase('usips_ncmec_case_delete_warning_incidents_unassigned') }}
            </xf:inforow>
        </div>
        <xf:submitrow rowtype="simple" icon="delete" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_case_edit" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_edit_case') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-cases/view', $case) }}">{{ $case.title }}</xf:breadcrumb>

<xf:form action="{{ link('ncmec-cases/edit', $case) }}" ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:textboxrow name="title" value="{$case.title}" label="{{ phrase('title') }}" />

            <xf:textarearow name="additional_info" value="{$case.additional_info}"
                label="{{ phrase('usips_ncmec_additional_info') }}" rows="2" />

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_incident_summary') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible is-active">
                <xf:selectrow name="incident_type" value="{$case.incident_type}"
                    label="{{ phrase('usips_ncmec_incident_type') }}" required="true">
                    <xf:option value=""></xf:option>
                    <xf:foreach loop="$incidentTypes" key="$type" value="$label">
                        <xf:option value="{$type}">{$label}</xf:option>
                    </xf:foreach>
                </xf:selectrow>

                <xf:checkboxrow name="report_annotations" label="{{ phrase('usips_ncmec_report_annotations') }}">
                    <xf:foreach loop="$reportAnnotations" key="$key" value="$value">
                        <xf:option value="{$value}" selected="{{ $case.isInReportAnnotations($value) }}">
                            {$reportAnnotationLabels.{$key}}
                        </xf:option>
                    </xf:foreach>
                </xf:checkboxrow>

                <xf:formrow label="{{ phrase('usips_ncmec_incident_date_time') }}">
                    <xf:if is="$incidentDateTime">
                        <xf:date time="$incidentDateTime" />
                        <xf:else />
                        {{ phrase('n_a') }}
                    </xf:if>
                    <div class="formRow-explain">{{ phrase('usips_ncmec_incident_date_time_explain') }}</div>
                </xf:formrow>

                <xf:textarearow name="incident_date_time_desc" value="{$case.incident_date_time_desc}"
                    label="{{ phrase('usips_ncmec_incident_date_time_desc') }}" rows="2" />
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_internet_details') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible">
                <xf:formrow>
                    {{ phrase('usips_ncmec_inferred_from_incident_content') }}
                </xf:formrow>
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_law_enforcement') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible">
                <xf:formrow>
                    {{ phrase('usips_ncmec_not_yet_supported') }}
                </xf:formrow>
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_reporter') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible is-active">
                <xf:textboxrow value="{{ $defaultContactPerson ? $defaultContactPerson.display_name : phrase('n_a') }}"
                    label="{{ phrase('usips_ncmec_default_contact_person') }}" readonly="true" />

                <xf:textboxrow value="{$termsOfServiceLink}" label="{{ phrase('usips_ncmec_terms_of_service_link') }}"
                    readonly="true" dir="ltr" />

                <xf:textboxrow value="{$reporterCompanyTemplate}"
                    label="{{ phrase('usips_ncmec_reporter_company_template') }}" readonly="true" dir="ltr" />

                <xf:macro template="usips_ncmec_macros" name="person_select" arg-name="reporter_person_id"
                    arg-value="{$case.reporter_person_id}" arg-persons="{$persons}"
                    arg-label="{{ phrase('usips_ncmec_reporter') }}" />
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_person_or_user_reported') }}
                </span>
            </h3>

            <div class="block-body block-body--collapsible is-active">
                <xf:formrow>
                    <div class="block-rowMessage block-rowMessage--warning">
                        {{ phrase('usips_ncmec_reported_person_warning') }}
                    </div>
                </xf:formrow>
                <xf:macro template="usips_ncmec_macros" name="person_select" arg-name="reported_person_id"
                    arg-value="{$case.reported_person_id}" arg-persons="{$persons}"
                    arg-label="{{ phrase('usips_ncmec_reported_person') }}" />

                <xf:textarearow name="reported_additional_info" value="{$case.reported_additional_info}"
                    label="{{ phrase('usips_ncmec_additional_info') }}" rows="3" />
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_intended_recipient') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible">
                <xf:formrow>
                    {{ phrase('usips_ncmec_not_yet_supported') }}
                </xf:formrow>
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_child_victim') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible">
                <xf:formrow>
                    {{ phrase('usips_ncmec_not_yet_supported') }}
                </xf:formrow>
            </div>

            <h3 class="block-formSectionHeader">
                <span class="collapseTrigger collapseTrigger--block" data-xf-click="toggle" data-target="< :up :next">
                    {{ phrase('usips_ncmec_associated_accounts') }}
                </span>
            </h3>
            <div class="block-body block-body--collapsible">
                <xf:formrow>
                    {{ phrase('usips_ncmec_inferred_from_incident_users') }}
                </xf:formrow>
            </div>

            <xf:submitrow sticky="true" icon="save">
                <xf:html>
                    <xf:button type="submit" icon="save" name="exit">{{ phrase('save_and_exit') }}</xf:button>
                </xf:html>
            </xf:submitrow>
        </div>
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_case_finalize" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_finalize_case') }}</xf:title>

<xf:form action="{{ link('ncmec-cases/finalize', $case) }}" ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:if is="$apiEnvironment == 'production'">
                <div class="block-rowMessage block-rowMessage--success">
                    {{phrase('usips_ncmec_environment_live') }}
                </div>
                <xf:else />
                <div class="block-rowMessage block-rowMessage--warning">
                    {{ phrase('usips_ncmec_environment_test') }}
                </div>
            </xf:if>

            <xf:inforow rowtype="confirm">
                {{ phrase('usips_ncmec_finalize_case_confirm_text', {'title': $case.title}) }}
            </xf:inforow>

            <xf:if is="$previews is not empty">
                <xf:foreach loop="$previews" value="$preview">
                    <h3 class="block-formSectionHeader">
                        <span class="block-formSectionHeader-aligner">
                            {{ phrase('usips_ncmec_report') }}: {$preview.user.username}
                        </span>
                    </h3>
                    <xf:if is="$preview.error">
                        <div class="block-row">
                            <div class="blockMessage blockMessage--error">{$preview.error}</div>
                        </div>
                        <xf:else />
                        <xf:codeeditorrow name="xml_preview_{$preview.user.user_id}" value="{$preview.xml}" mode="xml"
                            readonly="true" rowtype="fullWidth noLabel" />
                    </xf:if>
                </xf:foreach>
                <hr class="block-separator" />
            </xf:if>

            <xf:checkboxrow explain="{{ phrase('usips_ncmec_finalize_deletion_warning') }}">
                <xf:option name="confirm" value="1" label="{{ phrase('usips_ncmec_confirm_finalize_permanent') }}"
                    required="true" />
            </xf:checkboxrow>
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_finalize_case') }}" rowtype="simple" icon="save" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_case_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_cases') }}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('ncmec-cases/create') }}" icon="add">
        {{ phrase('usips_ncmec_create_case') }}
    </xf:button>
</xf:pageaction>

<xf:form action="{{ link('ncmec-cases/create') }}" class="block">
    <div class="block-outer">
        <xf:macro template="filter_macros" name="quick_filter" arg-key="cases" arg-class="block-outer-opposite" />
    </div>
    <div class="block-container">
        <h2 class="block-tabHeader tabs hScroller" data-xf-init="h-scroller">
            <span class="hScroller-scroll">
                <xf:foreach loop="$tabs" key="$tabState" value="$tabLabel">
                    <a href="{{ link('ncmec-cases', null, {'state': $tabState}) }}"
                        class="tabs-tab {{ $tabState == $state ? 'is-active' : '' }}">{$tabLabel}</a>
                </xf:foreach>
            </span>
        </h2>
        <div class="block-body">
            <xf:if is="$cases is not empty">
                <xf:macro template="usips_ncmec_macros" name="case_list" arg-cases="{$cases}" />
                <xf:else />
                <div class="block-row">{{ phrase('no_results_found') }}</div>
            </xf:if>
        </div>
    </div>
    <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}" link="ncmec-cases"
        wrapperclass="block-outer block-outer--after" />
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_case_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_case') }}</xf:title>

<div class="block">
    <div class="block-container">
        <h3 class="block-header">{{ phrase('usips_ncmec_case_details') }}</h3>
        <div class="block-body">
            <xf:formrow label="{{ phrase('title') }}">
                {$case.title}
            </xf:formrow>

            <xf:formrow label="{{ phrase('created_by') }}">
                <xf:if is="$case.User">
                    <xf:username user="{$case.User}" />
                    <xf:else />
                    {$case.username}
                </xf:if>
            </xf:formrow>

            <xf:formrow label="{{ phrase('usips_ncmec_created_on') }}">
                <xf:date time="{$case.created_date}" />
            </xf:formrow>

            <xf:formrow label="{{ phrase('last_updated') }}">
                <xf:date time="{$case.last_update_date}" />
            </xf:formrow>

            <xf:if is="$case.incident_type">
                <xf:formrow label="{{ phrase('usips_ncmec_incident_type') }}">
                    {$case.incident_type}
                </xf:formrow>
            </xf:if>

            <xf:if is="$case.finalized_on">
                <xf:formrow label="{{ phrase('usips_ncmec_status') }}">
                    <xf:if is="$case.submitted_on">
                        <span class="label label--green">{{ phrase('usips_ncmec_case_submitted') }}</span>
                        <div class="inputGroup-text">
                            {{ phrase('usips_ncmec_case_submitted_desc') }}
                        </div>
                        <xf:else />
                        <span class="label label--orange">{{ phrase('usips_ncmec_case_finalized') }}</span>
                        <div class="inputGroup-text">
                            {{ phrase('usips_ncmec_case_finalized_desc') }}
                        </div>
                    </xf:if>
                </xf:formrow>
            </xf:if>

            <xf:if is="$case.additional_info">
                <xf:formrow label="{{ phrase('usips_ncmec_additional_info') }}">
                    {$case.additional_info}
                </xf:formrow>
            </xf:if>
        </div>
        <xf:formrow label="{{ phrase('usips_ncmec_case_statistics') }}">
            <div class="pairWrapper pairWrapper--spaced">
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_incidents') }}</dt>
                    <dd>{$incidentCount}</dd>
                </dl>
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_reports') }}</dt>
                    <dd>{$reportCount}</dd>
                </dl>
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_unique_users') }}</dt>
                    <dd>{$uniqueUserCount}</dd>
                </dl>
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_associated_users') }}</dt>
                    <dd>{$totalUsers|number}</dd>
                </dl>
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_associated_content') }}</dt>
                    <dd>{$totalContent|number}</dd>
                </dl>
                <dl class="pairs pairs--columns pairs--fixedSmall">
                    <dt>{{ phrase('usips_ncmec_associated_attachment_data') }}</dt>
                    <dd>{$totalAttachments|number}</dd>
                </dl>
            </div>
        </xf:formrow>

        <xf:formrow>
            <xf:if is="{{ $case.canEdit() }}">
                <xf:button href="{{ link('ncmec-cases/edit', $case) }}" icon="edit">
                    {{ phrase('edit') }}
                </xf:button>
                <xf:button href="{{ link('ncmec-cases/finalize', $case) }}" icon="confirm" overlay="true">
                    {{ phrase('usips_ncmec_finalize_case') }}
                </xf:button>
                <xf:elseif is="$case.finalized_on AND !$case.submitted_on" />
                <xf:button href="{{ link('ncmec-cases/submit', $case) }}" icon="export" overlay="true">
                    {{ phrase('usips_ncmec_case_submit') }}
                </xf:button>
            </xf:if>
        </xf:formrow>
    </div>
</div>

<xf:if is="$incidents.count()">
    <div class="block">
        <div class="block-container">
            <h3 class="block-header">
                {{ phrase('usips_ncmec_incidents') }}
            </h3>
            <div class="block-body">
                <div class="structItemContainer">
                    <xf:macro template="usips_ncmec_macros" name="incident_list" arg-incidents="{$incidents}"
                        arg-case="{$case}" />
                </div>
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ display_totals($incidents) }}</span>
            </div>
        </div>
    </div>
</xf:if>

<xf:if is="$reports.count()">
    <div class="block">
        <div class="block-container">
            <h3 class="block-header">
                {{ phrase('usips_ncmec_reports') }}
            </h3>
            <div class="block-body">
                <div class="structItemContainer">
                    <xf:macro template="usips_ncmec_macros" name="report_list" arg-reports="{$reports}" />
                </div>
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ display_totals($reports) }}</span>
            </div>
        </div>
    </div>
</xf:if>]]></template>
  <template type="admin" title="usips_ncmec_config" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_configure_api') }}</xf:title>

<xf:form action="{{ link('ncmec/config') }}" class="block" ajax="true">
    <div class="block-container">
		<div class="block-body">
			<xf:if is="!empty($xf.option.option_value.username)">
				<xf:formrow label="{{ phrase('option.usipsNcmecApi') }}" explain="{{ phrase('option_explain.usipsNcmecApi') }}" rowclass="{$rowClass}">

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('usips_ncmec_environment') }}</dt>
						<dd>
							{{ $option.option_value.environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
						</dd>
					</dl>

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('user_name') }}</dt>
						<dd>{$option.option_value.username}</dd>
					</dl>

					<dl class="pairs pairs--columns pairs--fixedSmall">
						<dt>{{ phrase('password') }}</dt>
						<dd>********</dd>
					</dl>
				</xf:formrow>
			</xf:if>

            <xf:radiorow label="{{ phrase('usips_ncmec_environment') }}" rowtype="radio">
                <xf:option name="environment" value="test" checked="true">
                    {{ phrase('usips_ncmec_env_test') }}
                </xf:option>
                <xf:option name="environment" value="production">
                    {{ phrase('usips_ncmec_env_live') }}
                </xf:option>
            </xf:radiorow>

            <xf:formrow label="{{ phrase('usips_ncmec_esp_credentials') }}" rowtype="input"
                explain="{{ phrase('usips_ncmec_esp_credentials_explain') }}">
                <div class="inputGroup">
                    <xf:textbox name="username" placeholder="{{ phrase('user_name') }}" size="20" autocomplete="off" />
                    <span class="inputGroup-splitter"></span>
                    <xf:textbox type="password" name="password" placeholder="{{ phrase('password') }}" size="20"
                        autocomplete="new-password" />
                </div>
            </xf:formrow>
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_test_connection') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_config_confirm" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_configure_api') }}</xf:title>

<xf:form action="{{ link('ncmec/config/save') }}" class="block">
    <xf:hiddenval name="username">{$config.username}</xf:hiddenval>
    <xf:hiddenval name="password">{$config.password}</xf:hiddenval>
    <xf:hiddenval name="environment">{$config.environment}</xf:hiddenval>

    <div class="block-container">
        <div class="block-body">
            <div class="blockMessage blockMessage--success blockMessage--iconic">
                {{ phrase('usips_ncmec_connection_successful') }}
            </div>

            <xf:formrow label="{{ phrase('usips_ncmec_environment') }}">
                {{ $environment === 'live' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test') }}
            </xf:formrow>

            <xf:formrow label="{{ phrase('user_name') }}">
                {$config.username}
            </xf:formrow>
        </div>
        <xf:submitrow icon="save" submit="{{ phrase('usips_ncmec_save_configuration') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_content_preview" version_id="0" version_string="1.0.0"><![CDATA[<xf:head option="metaNoindex">
	<meta name="robots" content="noindex" />
</xf:head>

<div class="tooltip-content-inner">
	{{ bb_code($contentText, 'post:thread_preview', $content, { 'lightbox': false }) }}

	<xf:if is="$attachments">
		<hr />
		<div class="usips-ncmec-attachments">
			<ul class="listInline">
				<xf:foreach loop="$attachments" value="$attachment">
					<li>
						<xf:if is="$attachment.thumbnail_url">
							<a href="{{ link('attachments', $attachment) }}" target="_blank"
								class="attachment-thumbnail">
								<img src="{{ $attachment.thumbnail_url }}" alt="{{ $attachment.filename }}"
									style="max-width: 150px; max-height: 150px; vertical-align: middle;" />
							</a>
							<xf:else />
							NOT AN IMAGE
						</xf:if>
					</li>
				</xf:foreach>
			</ul>
		</div>
	</xf:if>

	<span class="tooltip-content-cover"></span>
</div>]]></template>
  <template type="admin" title="usips_ncmec_dashboard" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_dashboard') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('ncmec/config') }}" icon="config" overlay="true">{{ phrase('usips_ncmec_configure_api') }}
	</xf:button>
</xf:pageaction>

<xf:if is="!$apiConfigured">
	<div class="blockMessage blockMessage--important blockMessage--iconic">
		{{ phrase('usips_ncmec_api_not_configured') }}
	</div>
	<xf:elseif is="$connectionError" />
	<div class="blockMessage blockMessage--error blockMessage--iconic">
		{$connectionError}
	</div>
</xf:if>

<div class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_api_status') }}</h2>
		<div class="block-body">
			<xf:formrow label="{{ phrase('usips_ncmec_api_configured') }}">
				{{ $apiConfigured ? phrase('yes') : phrase('no') }}
			</xf:formrow>

			<xf:if is="$apiConfigured">
				<xf:formrow label="{{ phrase('usips_ncmec_environment') }}">
					{{ $environment === 'production' ? phrase('usips_ncmec_env_live') : phrase('usips_ncmec_env_test')
					}}
				</xf:formrow>
			</xf:if>
		</div>
	</div>
</div>

<div class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_quick_actions') }}</h2>
		<div class="block-body">
			<xf:formrow label="{{ phrase('enable_registration') }}" rowtype="button">
				{{ $xf.options.registrationSetup.enabled ? phrase('yes') : phrase('no') }}
				<xf:button href="{{ link('ncmec/registration/toggle') }}" class="button--link" data-xf-click="switch"
					data-sk-enable="{{ phrase('enable') }}" data-sk-disable="{{ phrase('disable') }}">
					{{ $xf.options.registrationSetup.enabled ? phrase('disable') : phrase('enable') }}
				</xf:button>
			</xf:formrow>

			<xf:if is="is_addon_active('Siropu/ReferralContests')">
				<xf:formrow label="{{ phrase('option.siropuReferralContestsInvitationOnly') }}" rowtype="button">
					{{ $xf.options.siropuReferralContestsInvitationOnly ? phrase('yes') : phrase('no') }}
					<xf:button href="{{ link('ncmec/invite-only/toggle') }}" class="button--link" data-xf-click="switch"
						data-sk-enable="{{ phrase('enable') }}" data-sk-disable="{{ phrase('disable') }}">
						{{ $xf.options.siropuReferralContestsInvitationOnly ? phrase('disable') : phrase('enable') }}
					</xf:button>
				</xf:formrow>
			</xf:if>
		</div>
	</div>
</div>

<xf:form action="{{ link('ncmec-incidents/assign-case') }}" data-xf-init="select-plus"
	data-sp-checkbox="input[name='incident_ids[]']" data-sp-container=".dataList-row">
	<xf:macro id="usips_ncmec_macros::incident_list_block" arg-incidents="{$incidents}" arg-nav="{{ false }}"
		arg-header="{{ true }}" arg-total="{{ $incidents|count }}" />
</xf:form>

<xf:macro id="usips_ncmec_macros::report_list_block" arg-incidents="{$reports}" arg-nav="{{ false }}"
	arg-header="{{ true }}" />]]></template>
  <template type="admin" title="usips_ncmec_incident_assign_case" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_assign_case') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/assign-case') }}" ajax="true" class="block">
    <xf:foreach loop="$incidentIds" value="$incidentId">
        <xf:hiddenval name="incident_ids[]" value="{$incidentId}" />
    </xf:foreach>

    <div class="block-container">
        <div class="block-body">
            <xf:formrow rowtype="confirm">
                {{ phrase('usips_ncmec_assign_case_description', {'count': $incidentCount}) }}
            </xf:formrow>

            <xf:radiorow name="assign_action" value="new" label="{{ phrase('action') }}">
                <xf:option value="new" label="{{ phrase('usips_ncmec_create_new_case') }}" selected="true">
                    <xf:dependent>
                        <xf:textbox name="new_case_title" value="{$defaultTitle}" placeholder="{{ phrase('title') }}"
                            maxlength="100" />
                        <div class="formRow-explain">{{ phrase('usips_ncmec_new_case_title_hint') }}</div>
                    </xf:dependent>
                </xf:option>
                <xf:option value="existing" label="{{ phrase('usips_ncmec_add_to_existing_case') }}"
                    disabled="{{ $availableCases is empty }}">
                    <xf:dependent>
                        <xf:select name="case_id">
                            <xf:foreach loop="$availableCases" value="$case">
                                <xf:option value="{$case.case_id}">{{ $case.title ?: phrase('usips_ncmec_untitled_case')
                                    }}
                                </xf:option>
                            </xf:foreach>
                        </xf:select>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:submitrow icon="merge" submit="{{ phrase('usips_ncmec_assign_case') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_create" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_create_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/create') }}" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:radiorow name="incident_action" label="{{ phrase('usips_ncmec_incident') }}" value="new">
                <xf:option value="new" label="{{ phrase('usips_ncmec_create_new_incident') }}">
                    <xf:dependent>
                        <xf:textbox name="title" value="{$title}" label="{{ phrase('title') }}" />
                    </xf:dependent>
                </xf:option>
                <xf:option value="existing" label="{{ phrase('usips_ncmec_existing_incident') }}"
                    disabled="{{ !$existingIncidents }}">
                    <xf:dependent>
                        <xf:select name="existing_incident_id">
                            <xf:foreach loop="$existingIncidents" value="$incident">
                                <xf:option value="{$incident.incident_id}">{$incident.title} ({{
                                    date($incident.created_date) }})</xf:option>
                            </xf:foreach>
                        </xf:select>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:if is="$attachments">
            <div class="block-body">
                <xf:macro name="usips_ncmec_incident_create::attachment_user_list"
                    arg-attachmentsByUser="{$attachmentsByUser}" arg-users="{$users}"
                    arg-checked="{$attachmentsChecked}" />
            </div>
        </xf:if>

        <div class="block-body">
            <xf:checkbox name="confirm" label="{{ phrase('confirm_submission') }}" value="1" checked="{$confirm}" />
        </div>
        <xf:submitrow sticky="true">
            <xf:html>
                <xf:button type="submit" name="submit" value="1" icon="save">{{ phrase('save') }}</xf:button>
            </xf:html>
        </xf:submitrow>
    </div>
</xf:form>

<xf:macro name="attachment_user_list" arg-attachmentsByUser="!" arg-users="!" arg-checked="{{ [] }}">
    <xf:datalist data-xf-init="responsive-data-list">
        <xf:datarow rowtype="header">
            <xf:cell>
                <span class="u-pullRight">
                    <xf:checkbox standalone="true">
                        <xf:option check-all="< .dataList" label="{{ phrase('select_all') }}" />
                    </xf:checkbox>
                </span>
                {{ phrase('users') }}
            </xf:cell>
        </xf:datarow>
        <xf:foreach loop="$attachmentsByUser" value="$attachments" key="$userId">
            <xf:set var="$user" value="{$users.{$userId}}" />
            <tbody class="dataList-rowGroup">
                <xf:datarow rowtype="subsection" rowclass="dataList-row--noHover">
                    <xf:cell>
                        <span class="u-pullRight">
                            <xf:checkbox standalone="true" name="user_ids[]" value="{$userId}">
                                <xf:option check-all="< .dataList-rowGroup" label="{{ phrase('select_all') }}" />
                            </xf:checkbox>
                        </span>
                        <ul class="listInline listInline--bullet">
                            <li>
                                <xf:avatar user="$user" size="xxs" href="" /> {$user.username}
                            </li>
                            <li>
                                {{ phrase('Joined') }}
                                <xf:date time="$user.register_date" />
                            </li>
                        </ul>
                    </xf:cell>
                </xf:datarow>
                <xf:datarow rowclass="dataList-cell--collapsible dataList-row--noHover">
                    <xf:cell class=" dataList-cell--usips-attachmentList">
                        <xf:macro name="usips_ncmec_macros::attachment_list" arg-attachments="{$attachments}"
                            arg-checked="{$checked}" />
                    </xf:cell>
                </xf:datarow>
            </tbody>
        </xf:foreach>
    </xf:datalist>
</xf:macro>]]></template>
  <template type="admin" title="usips_ncmec_incident_create_case" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_assign_case') }}</xf:title>

<xf:form action="{{ link('ncmec-cases/create') }}" ajax="true" class="block">
    <xf:foreach loop="$incidentIds" value="$incidentId">
        <xf:hiddenval name="incident_ids[]" value="{$incidentId}" />
    </xf:foreach>

    <div class="block-container">
        <div class="block-body">
            <xf:formrow rowtype="confirm">
                {{ phrase('usips_ncmec_assign_case_description', {'count': $incidentCount}) }}
            </xf:formrow>

            <xf:radiorow name="assign_action" value="new" label="{{ phrase('action') }}">
                <xf:option value="new" label="{{ phrase('usips_ncmec_create_new_case') }}" selected="true">
                    <xf:dependent>
                        <xf:textbox name="new_case_title" value="{$defaultTitle}" placeholder="{{ phrase('title') }}"
                            maxlength="100" />
                        <div class="formRow-explain">{{ phrase('usips_ncmec_new_case_title_hint') }}</div>
                    </xf:dependent>
                </xf:option>
                <xf:option value="existing" label="{{ phrase('usips_ncmec_add_to_existing_case') }}"
                    disabled="{{ $availableCases is empty }}">
                    <xf:dependent>
                        <xf:select name="case_id">
                            <xf:foreach loop="$availableCases" value="$case">
                                <xf:option value="{$case.case_id}">{{ $case.title ?: phrase('usips_ncmec_untitled_case')
                                    }}
                                </xf:option>
                            </xf:foreach>
                        </xf:select>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:submitrow icon="merge" submit="{{ phrase('usips_ncmec_assign_case') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_delete" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_confirm_incident_deletion') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/delete', $incident) }}" class="block">

    <div class="block-container">
        <div class="block-header">
            <h2 class="block-tabHeader">{{ phrase('usips_ncmec_confirm_incident_deletion') }}</h2>
        </div>

        <div class="block-body">
            <xf:if is="$incident.finalized_on">
                <xf:inforow rowtype="error">
                    {{ phrase('usips_ncmec_incident_finalized_cannot_delete') }}
                </xf:inforow>
                <xf:else />
                <xf:inforow rowtype="confirm">
                    {{ phrase('please_confirm_that_you_want_to_delete_following:') }}
                    <strong><a href="{{ link('ncmec-incidents/edit', $incident) }}">{$incident.title}</a></strong>
                </xf:inforow>

                <xf:submitrow submit="{{ phrase('delete') }}" />
            </xf:if>
        </div>
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incidents') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('ncmec-incidents/create') }}" icon="add">
		{{ phrase('usips_ncmec_create_incident') }}
	</xf:button>
</xf:pageaction>

<xf:form action="{{ link('ncmec-incidents/assign-case') }}" class="block" data-xf-init="select-plus"
	data-sp-checkbox="input[name='incident_ids[]']" data-sp-container=".dataList-row">
	<div class="block-outer">
		<xf:macro template="filter_macros" name="quick_filter" arg-key="incidents" arg-class="block-outer-opposite" />
	</div>
	<div class="block-container">
		<h2 class="block-tabHeader tabs hScroller" data-xf-init="h-scroller">
			<span class="hScroller-scroll">
				<xf:foreach loop="$tabs" key="$tabState" value="$tabLabel">
					<a href="{{ link('ncmec-incidents', null, {'state': $tabState}) }}"
						class="tabs-tab {{ $tabState == $state ? 'is-active' : '' }}">{$tabLabel}</a>
				</xf:foreach>
			</span>
		</h2>
		<div class="block-body">
			<xf:if is="$incidents is not empty">
				<xf:macro template="usips_ncmec_macros" name="incident_list" arg-incidents="{$incidents}" />
				<xf:else />
				<div class="block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
		</div>
		<xf:if is="$incidents is not empty">
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter">{{ display_totals($incidents, $total) }}</span>
				<span class="block-footer-select">
					<xf:checkbox standalone="true">
						<xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" />
					</xf:checkbox>
				</span>
				<span class="block-footer-controls">
					<xf:button type="submit" name="assign_case" icon="merge">{{
						phrase('usips_ncmec_assign_case') }}</xf:button>
				</span>
			</div>
		</xf:if>
	</div>
	<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}" link="ncmec-incidents"
		wrapperclass="block-outer block-outer--after" />
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_remove_content" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_remove_content_from_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/remove-content', $incident, {
    'content_type': $incidentContent.content_type,
    'content_id': $incidentContent.content_id
}) }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body">
            {{ phrase('usips_ncmec_remove_content_confirm', {
            'title': $contentTitle
            }) }}
        </div>
        <xf:submitrow submit="{{ phrase('delete') }}" icon="delete" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_unassign_case" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_unassign_incident_from_case') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/unassign-case', $incident) }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body">
            <xf:inforow rowtype="confirm">
                {{ phrase('usips_ncmec_please_confirm_that_you_want_to_unassign_incident_from_case', {'title':
                $incident.title}) }}
            </xf:inforow>
        </div>
        <xf:submitrow submit="{{ phrase('usips_ncmec_unassign') }}" rowtype="simple" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_user_content" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incident_user') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-incidents/view', $incident) }}">{$incident.title}</xf:breadcrumb>

<xf:pageaction if="true">
	<xf:button href="{{ link('users/edit', $user) }}" class="link">{{ phrase('edit_user') }}
	</xf:button>
	<xf:button href="{{ link_type('public', 'members', $user) }}" class="link">{{ phrase('view_public_profile') }}
	</xf:button>
	<xf:if is="!$incident.finalized_on">
		<xf:button href="{{ link('ncmec-incidents/user/delete', $incidentUser) }}" icon="delete" overlay="true" />
	</xf:if>
</xf:pageaction>

<xf:if is="!$incident.finalized_on">
	<xf:form action="{{ link('ncmec-incidents/user/associate-timestamp', $incidentUser) }}" ajax="true" class="block">
		<div class="block-container">
			<xf:formrow label="{{ phrase('usips_ncmec_content_time_limit') }}"
				explain="{{ phrase('usips_ncmec_content_time_limit_explain') }}">
				<xf:select name="time_limit_seconds">
					<xf:option value="-1" selected="{{ $timeLimitSelection == -1 }}">{{
						phrase('usips_ncmec_use_default_timespan', {'duration': $timeLimitDefaultDescription ?:
						phrase('all_time')}) }}</xf:option>
					<xf:option value="3600" selected="{{ $timeLimitSelection == 3600 }}">{{ phrase('1_hour') }}
					</xf:option>
					<xf:option value="86400" selected="{{ $timeLimitSelection == 86400 }}">{{ phrase('1_day') }}
					</xf:option>
					<xf:option value="172800" selected="{{ $timeLimitSelection == 172800 }}">{{ phrase('x_hours',
						{'count':
						48}) }}</xf:option>
					<xf:option value="604800" selected="{{ $timeLimitSelection == 604800 }}">{{ phrase('1_week') }}
					</xf:option>
					<xf:option value="2592000" selected="{{ $timeLimitSelection == 2592000 }}">{{ phrase('1_month') }}
					</xf:option>
					<xf:option value="0" selected="{{ $timeLimitSelection == 0 }}">{{ phrase('all_time') }}</xf:option>
				</xf:select>
			</xf:formrow>
			<xf:submitrow>
				<xf:html>
					<xf:button type="submit" name="submit" icon="attach">{{ phrase('usips_ncmec_associate') }}
					</xf:button>
				</xf:html>
			</xf:submitrow>
		</div>
	</xf:form>

	<xf:form action="{{ link('ncmec-incidents/user/update-attachments', $incidentUser) }}" ajax="true" class="block">
		<div class="block-container">
			<h2 class="block-header">{{ phrase('usips_ncmec_attachments') }}</h2>
			<xf:if is="$availableAttachments is not empty">
				<div class="block-body">
					<xf:macro name="usips_ncmec_macros::attachment_block" arg-incident="{$incident}"
						arg-attachments="{$availableAttachments}" arg-checked="{$associatedAttachmentIds}" />
				</div>
				<xf:else />
				<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
			<xf:submitrow sticky="true">
				<xf:html>
					<xf:button type="submit" name="submit" icon="save">{{ phrase('save') }}
					</xf:button>
				</xf:html>
			</xf:submitrow>
		</div>
	</xf:form>
</xf:if>]]></template>
  <template type="admin" title="usips_ncmec_incident_user_delete" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_remove_user_from_incident') }}</xf:title>

<xf:form action="{{ link('ncmec-incidents/user/delete', $incidentUser) }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body block-row">
            {{ phrase('usips_ncmec_remove_user_from_incident_confirm', {
            'user': $user.username,
            'incident': $incident.title
            }) }}
        </div>
        <xf:submitrow icon="delete" submit="{{ phrase('usips_ncmec_remove_user') }}" sticky="true" />
    </div>
    <xf:hiddenval name="_xfRedirect">{{ link('ncmec-incidents/view', $incident) }}</xf:hiddenval>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_incident_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_incident') }}</xf:title>

<xf:pageaction if="true">
    <xf:if is="$incident.case_id">
        <xf:button href="{{ link('ncmec-cases/view', {'case_id': $incident.case_id}) }}" icon="list">
            {{ phrase('usips_ncmec_view_case') }}
        </xf:button>
        <xf:else />
        <xf:button href="{{ link('ncmec-cases/create', null, {'incident_id': $incident.incident_id}) }}" icon="merge"
            overlay="true">
            {{ phrase('usips_ncmec_assign_case') }}
        </xf:button>
    </xf:if>
    <xf:if is="!$incident.finalized_on">
        <xf:button href="{{ link('ncmec-incidents/delete', $incident) }}" icon="delete" overlay="true" />
    </xf:if>
</xf:pageaction>

<xf:set var="$caseEditable"
    value="{{ !$incident.finalized_on && (!$incident.case_id || ($incident.Case && $incident.Case.canEdit())) }}" />

<xf:form action="{{ link('ncmec-incidents/update', $incident) }}" ajax="true" class="block">

    <div class="block-container">
        <div class="block-body">
            <xf:textboxrow name="title" value="{$incident.title}" label="{{ phrase('title') }}" />

            <xf:formrow label="{{ phrase('usips_ncmec_incident_status') }}">
                <xf:if is="$incident.finalized_on">
                    {{ phrase('usips_ncmec_finalized') }}
                    <xf:else />
                    {{ phrase('usips_ncmec_draft') }}
                </xf:if>
            </xf:formrow>

            <xf:if is="$caseEditable">
                <xf:selectrow name="case_id" value="{$incident.case_id}" label="{{ phrase('usips_ncmec_case') }}">
                    <xf:option value="0">{{ phrase('none') }}</xf:option>
                    <xf:foreach loop="$availableCases" value="$case">
                        <xf:option value="{$case.case_id}">{{ $case.title ?: phrase('usips_ncmec_untitled_case') }}
                        </xf:option>
                    </xf:foreach>
                </xf:selectrow>
                <xf:else />
                <xf:formrow label="{{ phrase('usips_ncmec_case') }}">
                    <xf:if is="$incident.case_id">
                        <a href="{{ link('ncmec-cases/view', {'case_id': $incident.case_id}) }}">
                            {{ $incident.Case ? $incident.Case.title : phrase('usips_ncmec_untitled_case') }}
                        </a>
                        <xf:else />
                        {{ phrase('none') }}
                    </xf:if>
                    <div class="formRow-explain">
                        {{ phrase('usips_ncmec_case_finalized_cannot_edit') }}
                    </div>
                </xf:formrow>

                <xf:formrow label="{{ phrase('usips_ncmec_associated_users') }}">
                    {{ $counts.users|number }}
                </xf:formrow>
                <xf:formrow label="{{ phrase('usips_ncmec_associated_content') }}">
                    {{ $counts.content|number }}
                </xf:formrow>
                <xf:formrow label="{{ phrase('usips_ncmec_associated_attachment_data') }}">
                    {{ $counts.attachments|number }}
                </xf:formrow>
            </xf:if>

            <xf:if is="$caseEditable">
                <xf:submitrow sticky="true" icon="save" />
            </xf:if>
        </div>
    </div>
</xf:form>

<xf:if is="$incident.IncidentUsers is not empty">
    <div class="block">
        <div class="block-container">
            <h2 class="block-header">
                {{ phrase('usips_ncmec_associated_users') }}
            </h2>
            <div class="block-body">
                <xf:macro name="usips_ncmec_macros::user_avatar_list" arg-users="{$incident.IncidentUsers}"
                    arg-incident="{$incident}" />
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ display_totals($incident.IncidentUsers) }}</span>
            </div>
        </div>
    </div>
</xf:if>

<xf:if is="$contentData">
    <div class="block">
        <div class="block-container">
            <h2 class="block-header">
                {{ phrase('usips_ncmec_associated_content') }}
            </h2>
            <div class="block-body">
                <xf:datalist class="dataList">
                    <xf:datarow rowtype="header">
                        <xf:cell>{{ phrase('title') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell></xf:cell>
                        <xf:cell></xf:cell>
                    </xf:datarow>
                    <xf:foreach loop="$contentData" value="$data">
                        <xf:datarow>
                            <xf:cell class="dataList-cell--link">
                                <xf:if is="method_exists($data.content, 'getContentUrl')">
                                    <a href="{{ $data.content.getContentUrl(true) }}" data-xf-init="preview-tooltip"
                                        data-preview-url="{{ link('ncmec-incidents/content/preview', $data.incident_content) }}">{$data.title}</a>
                                    <xf:else />
                                    {$data.title}
                                </xf:if>
                            </xf:cell>
                            <xf:cell>
                                <xf:avatar user="$data.incident_content.User" size="xxs" />
                                <xf:username user="{$data.incident_content.User}" />
                            </xf:cell>
                            <xf:action href="{{ $data.content.getContentUrl(true) }}">{{ phrase('view_content') }}
                            </xf:action>
                            <xf:if is="!$incident.finalized_on">
                                <xf:delete href="{{ link('ncmec-incidents/content/delete', $data.incident_content) }}"
                                    tooltip="{{ phrase('usips_ncmec_disassociate') }}" />
                            </xf:if>
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ phrase('showing_x_of_y_items', {
                    'count': $contentData|count,
                    'total': $counts.content
                    }) }}</span>
            </div>
        </div>
    </div>
</xf:if>]]></template>
  <template type="admin" title="usips_ncmec_macros" version_id="0" version_string="1.0.0"><![CDATA[<xf:macro id="case_list" arg-cases="{{ [] }}">
	<xf:datalist class="dataList">
		<xf:datarow rowtype="header">
			<xf:cell>{{ phrase('title') }}</xf:cell>
			<xf:cell>{{ phrase('user') }}</xf:cell>
			<xf:cell>{{ phrase('date') }}</xf:cell>
			<xf:cell>{{ phrase('status') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_incidents') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_reports') }}</xf:cell>
			<xf:cell></xf:cell>
		</xf:datarow>
		<xf:foreach loop="$cases" value="$case">
			<xf:datarow>
				<xf:cell class="dataList-cell--link">
					<a href="{{ link('ncmec-cases/view', $case) }}">
						{{ $case.title ?: phrase('usips_ncmec_untitled_case') }}
					</a>
				</xf:cell>
				<xf:cell>
					<xf:avatar user="$case.User" size="xxs" />
					<xf:username user="$case.User" />
				</xf:cell>
				<xf:cell>
					<xf:date time="$case.created_date" />
				</xf:cell>
				<xf:cell>
					<xf:if is="$case.finalized_on">
						<xf:if is="$case.submitted_on">
							{{ phrase('usips_ncmec_case_submitted') }}
							<xf:else />
							{{ phrase('usips_ncmec_case_finalized') }}
						</xf:if>
						<xf:else />
						{{ phrase('usips_ncmec_draft') }}
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:if is="$case.Incidents">
						{$case.Incidents.count()}
						<xf:else />
						0
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:if is="$case.Reports">
						{$case.Reports.count()}
						<xf:else />
						0
					</xf:if>
				</xf:cell>
				<xf:if is="!$case.finalized_on">
					<xf:delete href="{{ link('ncmec-cases/delete', $case) }}" />
					<xf:else />
					<xf:cell></xf:cell>
				</xf:if>
			</xf:datarow>
		</xf:foreach>
	</xf:datalist>
</xf:macro>

<xf:macro id="attachment_block" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:if is="$attachments is not empty">
		<div class="block-body">
			<xf:macro id="attachment_list" arg-attachments="{$attachments}" arg-checked="{$checked}"
				arg-incident="{$incident}" />
		</div>
		<xf:else />
		<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
	</xf:if>
</xf:macro>

<xf:macro id="attachment_list" arg-attachments="{{ [] }}" arg-checked="{{ [] }}" arg-incident="{{ false }}">
	<xf:css src="usips_ncmec.less" />
	<xf:js src="USIPS/NCMEC/attachment_browser.js" />
	<div class="usips-attachments">
		<xf:foreach loop="$attachments" value="$attachment">
			<span
				class="usips-attachment {{ $attachment.IncidentAttachmentData ? 'usips-attachment--inIncident' : '' }}">
				<input type="checkbox" class="usips-attachmentCheckbox"
					id="usips_attachment_{$attachment.attachment_id}" name="attachment_ids[]"
					value="{{ $attachment.attachment_id }}" {{ in_array($attachment.attachment_id, $checked) ? 'checked'
					: '' }} />
				<label class="usips-attachmentLabel" for="usips_attachment_{$attachment.attachment_id}">
					<xf:if is="$attachment.IncidentAttachmentData">
						<span class="usips-attachmentIndicator"
							title="{{ phrase('usips_ncmec_attachment_in_incident') }}" data-xf-init="tooltip">
							<xf:fa icon="fa-exclamation-triangle" />
						</span>
					</xf:if>
					<div class="usips-attachmentOverlay">
						<div class="usips-attachmentInfo">
							<ul>
								<li>{$attachment.content_type}</li>
								<xf:if is="$attachment.content_id == 0">
									<li>{{ phrase('draft') }}</li>
								</xf:if>
								<li>
									<xf:date time="{{ $attachment.Data.upload_date }}" />
								</li>
								<li>{$attachment.filename}</li>
								<xf:if is="$attachment.IncidentAttachmentData">
									<xf:foreach loop="$attachment.IncidentAttachmentData" value="$iad">
										<li class="u-marginTopSmall">
											<span class="usips-attachmentInfo-label">{{ phrase('usips_ncmec_incident')
												}}</span><br />
											<a
												href="{{ link('ncmec-incidents/view', $iad.Incident) }}">{$iad.Incident.title}</a>
										</li>
										<xf:if is="$iad.Incident.Case">
											<li>
												<span class="usips-attachmentInfo-label">{{ phrase('usips_ncmec_case')
													}}</span><br />
												<a
													href="{{ link('ncmec-cases/view', $iad.Incident.Case) }}">{$iad.Incident.Case.title}</a>
											</li>
										</xf:if>
									</xf:foreach>
								</xf:if>
							</ul>
						</div>
					</div>
					<xf:if is="$attachment.has_thumbnail">
						<a href="{{ link('ncmec-attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentThumbnail"
							style="background-image: url({$attachment.thumbnail_url})" alt="{$attachment.filename}">
						</a>
						<xf:elseif is="$attachment.is_audio" />
						<a href="{{ link('ncmec-attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon">
							<xf:fa icon="fa-volume fa-4x" />
						</a>
						<xf:elseif is="$attachment.is_video" />
						<a href="{{ link('ncmec-attachments/view', $attachment) }}" class="usips-attachmentLink">
							<video title="{$attachment.filename}" class="usips-attachmentVideo">
								<source src="{$attachment.direct_url}" />
							</video>
						</a>
						<xf:else />
						<a href="{{ link('ncmec-attachments/view', $attachment) }}"
							class="usips-attachmentLink usips-attachmentIcon">
							<xf:fa icon="fa-file fa-4x" />
						</a>
					</xf:if>
				</label>
			</span>
		</xf:foreach>
	</div>
</xf:macro>

<xf:macro id="incident_list" arg-incidents="{{ [] }}" arg-case="{{ null }}">
	<xf:datalist class="dataList">
		<xf:datarow rowtype="header">
			<xf:if is="!$case">
				<xf:cell></xf:cell>
			</xf:if>
			<xf:cell>{{ phrase('title') }}</xf:cell>
			<xf:cell>{{ phrase('user') }}</xf:cell>
			<xf:cell>{{ phrase('date') }}</xf:cell>
			<xf:cell>{{ phrase('status') }}</xf:cell>
			<xf:cell></xf:cell>
			<xf:if is="!$case OR !$case.finalized_on">
				<xf:cell></xf:cell>
			</xf:if>
		</xf:datarow>
		<xf:foreach loop="$incidents" value="$incident">
			<xf:datarow>
				<xf:if is="!$case">
					<xf:if is="$incident.finalized_on">
						<xf:cell></xf:cell>
						<xf:else />
						<xf:toggle name="incident_ids[]" value="{$incident.incident_id}" />
					</xf:if>
				</xf:if>

				<xf:cell class="dataList-cell--link">
					<a href="{{ link('ncmec-incidents/view', $incident) }}">
						{{ $incident.title ?: phrase('usips_ncmec_untitled_incident') }}
					</a>
				</xf:cell>
				<xf:cell>
					<xf:avatar user="$incident.User" size="xxs" />
					<xf:username user="$incident.User" />
				</xf:cell>
				<xf:cell>
					<xf:date time="$incident.created_date" />
				</xf:cell>
				<xf:cell>
					<xf:if is="$incident.finalized_on">
						{{ phrase('usips_ncmec_finalized') }}
						<xf:else />
						{{ phrase('usips_ncmec_draft') }}
					</xf:if>
				</xf:cell>
				<xf:if is="$incident.case_id && !$case">
					<xf:action href="{{ link('ncmec-cases/view', $incident.Case) }}">
						{{ phrase('usips_ncmec_case') }}
					</xf:action>
					<xf:else />
					<xf:cell></xf:cell>
				</xf:if>
				<xf:if is="!$case OR !$case.finalized_on">
					<xf:if is="$case">
						<xf:action href="{{ link('ncmec-incidents/unassign-case', $incident) }}" overlay="true">
							{{ phrase('usips_ncmec_unassign') }}
						</xf:action>
						<xf:elseif is="$incident.case_id" />
						<xf:if is="!$incident.finalized_on">
							<xf:delete href=" {{ link('ncmec-incidents/delete', $incident) }}" />
						</xf:if>
						<xf:else />
						<xf:cell></xf:cell>
					</xf:if>
				</xf:if>
			</xf:datarow>
		</xf:foreach>
	</xf:datalist>
</xf:macro>

<xf:macro id="incident_list_block" arg-incidents="{{ [] }}" arg-header="{{ false }}" arg-nav="{{ true }}"
	arg-total="{{ 0 }}">
	<div class="block">
		<div class="block-container">
			<xf:if is="{$header}">
				<h2 class="block-header">{{ phrase('usips_ncmec_incidents') }}</h2>
			</xf:if>
			<xf:if is="$incidents is not empty">
				<div class="block-body">
					<xf:macro id="incident_list" arg-incidents="{{ $incidents }}" />
				</div>

				<div class="block-footer block-footer--split">
					<span class="block-footer-counter">{{ display_totals($incidents, $total) }}</span>
					<span class="block-footer-select">
						<xf:checkbox standalone="true">
							<xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" />
						</xf:checkbox>
					</span>
					<span class="block-footer-controls">
						<xf:button type="submit" name="assign_case" icon="merge">{{
							phrase('usips_ncmec_assign_case') }}</xf:button>
					</span>
				</div>

				<xf:pagenav page="$page" perpage="$perPage" total="$total" link="ncmec-incidents"
					wrapperclass="block-outer block-outer--after" />
				<xf:else />
				<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
		</div>
	</div>
</xf:macro>

<xf:macro id="person_select" arg-name="!" arg-value="!" arg-persons="!" arg-label="" arg-hint="">
	<xf:selectrow name="{$name}" value="{$value}" label="{$label}" hint="{$hint}">
		<xf:option value="0"></xf:option>
		<xf:foreach loop="$persons" value="$person">
			<xf:option value="{$person.person_id}">{$person.display_name}</xf:option>
		</xf:foreach>
	</xf:selectrow>
</xf:macro>

<xf:macro id="report_list" arg-reports="{{ [] }}">
	<xf:datalist class="dataList">
		<xf:datarow rowtype="header">
			<xf:cell></xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_report_id') }}</xf:cell>
			<xf:cell>{{ phrase('created_by') }}</xf:cell>
			<xf:cell>{{ phrase('date') }}</xf:cell>
			<xf:cell>{{ phrase('status') }}</xf:cell>
			<xf:cell></xf:cell>
		</xf:datarow>
		<xf:foreach loop="$reports" value="$report">
			<xf:datarow>
				<xf:cell class="dataList-cell--link">
					<a href="{{ link('ncmec-reports/view', $report) }}">
						{{ phrase('usips_ncmec_report_created_on_x', {'datetime': phrase('date_x_at_time_y', {
						'date': date($report.created_date),
						'time': time($report.created_date)
						}) }) }}
					</a>
				</xf:cell>
				<xf:cell>
					<xf:if is="$report.ncmec_report_id">
						{$report.ncmec_report_id}
						<xf:else />
						<span class="u-muted">{{ phrase('n_a') }}</span>
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:avatar user="$report.User" size="xxs" />
					<xf:username user="$report.User" defaultname="{$report.username}" />
				</xf:cell>
				<xf:cell>
					<xf:date time="$report.created_date" />
				</xf:cell>
				<xf:cell>
					<xf:if is="$report.submitted_on">
						{{ phrase('usips_ncmec_finalized') }}
						<xf:else />
						{{ phrase('usips_ncmec_draft') }}
					</xf:if>
				</xf:cell>
				<xf:action href="{{ link('ncmec-cases/view', $report.Case) }}">
					{{ phrase('usips_ncmec_case') }}
				</xf:action>
			</xf:datarow>
		</xf:foreach>
	</xf:datalist>
</xf:macro>

<xf:macro id="report_list_block" arg-reports="{{ [] }}" arg-header="{{ false }}" arg-nav="{{ true }}">
	<div class="block">
		<div class="block-container">
			<xf:if is="{$header}">
				<h2 class="block-header">{{ phrase('usips_ncmec_reports') }}</h2>
			</xf:if>
			<xf:if is="$reports is not empty">
				<div class="block-body">
					<xf:macro id="report_list" arg-reports="{$reports}" />
				</div>

				<xf:pagenav page="$page" perpage="$perPage" total="$total" link="ncmec-reports"
					wrapperclass="block-outer block-outer--after" />
				<xf:else />
				<div class="block-body block-row">{{ phrase('no_results_found') }}</div>
			</xf:if>
		</div>
	</div>
</xf:macro>

<xf:macro id="api_log_list" arg-logs="{{ [] }}">
	<xf:datalist class="dataList">
		<xf:datarow rowtype="header">
			<xf:cell>{{ phrase('date') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_environment') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_endpoint') }}</xf:cell>
			<xf:cell>{{ phrase('status') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_response_code') }}</xf:cell>
			<xf:cell>{{ phrase('usips_ncmec_report') }}</xf:cell>
			<xf:cell>{{ phrase('user') }}</xf:cell>
			<xf:cell></xf:cell>
		</xf:datarow>
		<xf:foreach loop="$logs" value="$log">
			<xf:datarow>
				<xf:cell>
					<xf:date time="{$log.request_date}" />
				</xf:cell>
				<xf:cell>
					<xf:if is="$log.environment == 'test'">
						<span class="label label--orange">{{ phrase('usips_ncmec_test') }}</span>
						<xf:elseif is="$log.environment == 'production'" />
						<span class="label label--red">{{ phrase('usips_ncmec_live') }}</span>
						<xf:else />
						{$log.environment}
					</xf:if>
				</xf:cell>
				<xf:cell>
					<code>{$log.request_method}</code> {$log.request_endpoint}
				</xf:cell>
				<xf:cell>
					<xf:if is="$log.success">
						<span class="label label--green">{{ phrase('success') }}</span>
						<xf:else />
						<span class="label label--red">{{ phrase('error') }}</span>
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:if is="$log.response_code">
						{$log.response_code}
						<xf:else />
						<span class="u-muted">{{ phrase('n_a') }}</span>
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:if is="$log.Report">
						<a href="{{ link('ncmec-reports/view', $log.Report) }}">
							<xf:if is="$log.Report.Case">
								{$log.Report.Case.title}
								<xf:else />
								{{ phrase('usips_ncmec_report') }} #{$log.report_id}
							</xf:if>
						</a>
						<xf:else />
						<span class="u-muted">{{ phrase('n_a') }}</span>
					</xf:if>
				</xf:cell>
				<xf:cell>
					<xf:if is="$log.User">
						<xf:avatar user="$log.User" size="xxs" />
						<xf:username user="$log.User" />
						<xf:else />
						<span class="u-muted">{{ phrase('n_a') }}</span>
					</xf:if>
				</xf:cell>
				<xf:cell class="dataList-cell--action">
					<a href="{{ link('ncmec-api-logs/view', $log) }}" data-xf-click="overlay">{{ phrase('view') }}</a>
				</xf:cell>
			</xf:datarow>
		</xf:foreach>
	</xf:datalist>
</xf:macro>

<xf:macro id="user_avatar_list" arg-users="{{ [] }}" arg-incident="{{ false }}">
	<div class="user-avatars">
		<xf:foreach loop="$users" value="$user">
			<xf:avatar user="$user.User" size="s"
				href="{{ $incident ? ($incident.finalized_on ? link('users/edit', $user.User) : link('ncmec-incidents/user', $user)) : '' }}" />
		</xf:foreach>
	</div>
</xf:macro>

<xf:macro id="user_avatar_block" arg-users="{{ [] }}" arg-incident="{{ false }}">
	<xf:if is="$users is not empty">
		<div class="block">
			<div class="block-container">
				<h2 class="block-header">{{ phrase('usips_ncmec_users') }}</h2>
				<div class="block-body">
					<xf:macro name="usips_ncmec_macros::user_avatar_list" arg-users="{$users}"
						arg-incident="{$incident}" />
				</div>
			</div>
		</div>
	</xf:if>
</xf:macro>]]></template>
  <template type="admin" title="usips_ncmec_person_edit" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ $person.isInsert() ? phrase('usips_ncmec_add_person') : phrase('usips_ncmec_edit_person') }}</xf:title>

<xf:form action="{{ $person.isInsert() ? link('ncmec-people/create') : link('ncmec-people/update', $person) }}"
    ajax="true" class="block">
    <div class="block-container">
        <xf:if is="$success">
            <div class="blockMessage blockMessage--success blockMessage--iconic">{{
                phrase('your_changes_have_been_saved') }}</div>
        </xf:if>
        <div class="block-body">
            <xf:textboxrow name="username" value="{$person.username}" label="{{ phrase('user') }}" ac="single" />
            <xf:textboxrow name="title" value="{$person.title}" label="{{ phrase('title') }}" maxlength="255" />
            <xf:textboxrow name="first_name" value="{$person.first_name}" label="{{ phrase('usips_ncmec_first_name') }}"
                maxlength="100" />
            <xf:textboxrow name="last_name" value="{$person.last_name}" label="{{ phrase('usips_ncmec_last_name') }}"
                maxlength="100" />

            <xf:radiorow name="age_selector" value="{$ageSelectorValue}" label="{{ phrase('age') }}" required="false"
                explain="{{ phrase('usips_ncmec_age_selector_explain') }}">
                <xf:option value="none" label="{{ phrase('unknown') }}" />
                <xf:option value="date_of_birth" label="{{ phrase('date_of_birth') }}">
                    <xf:dependent>
                        <div class="inputGroup">
                            <xf:textbox name="date_of_birth" value="{$person.date_of_birth}" type="date" />
                        </div>
                    </xf:dependent>
                </xf:option>
                <xf:option value="age" label="{{ phrase('age') }}">
                    <xf:dependent>
                        <div class="inputGroup">
                            <xf:numberbox name="age" value="{{ $person.age !== null ? $person.age : '' }}" min="0"
                                step="1" />
                        </div>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:submitrow icon="save" sticky="true" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_person_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_people' )}}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('ncmec-people/create') }}" icon="add">{{ phrase('usips_ncmec_add_person') }}</xf:button>
</xf:pageaction>

<div class="block">
    <div class="block-container">
        <xf:if is="$persons is not empty">
            <div class="block-body">
                <xf:datalist>
                    <xf:datarow rowtype="header">
                        <xf:cell>{{ phrase('name') }}</xf:cell>
                        <xf:cell>{{ phrase('age') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell>{{ phrase('usips_ncmec_created_by') }}</xf:cell>
                        <xf:cell>{{ phrase('usips_ncmec_created_on') }}</xf:cell>
                        <xf:cell>{{ phrase('usips_ncmec_last_updated_on') }}</xf:cell>
                        <xf:cell></xf:cell>
                    </xf:datarow>
                    <xf:foreach loop="$persons" value="$person">
                        <xf:datarow>
                            <xf:cell>
                                <a href="{{ link('ncmec-people/edit', $person) }}">{{$person.display_name}}</a>
                            </xf:cell>
                            <xf:cell>
                                <xf:if is="$person.date_of_birth">
                                    {{ $person.getYearsOld() }} (b. {{ $person.date_of_birth }})
                                    <xf:elseif is="$person.age !== null" />{{ $person.age|number }}
                                    <xf:else />
                                    &ndash;
                                </xf:if>
                            </xf:cell>
                            <xf:cell>
                                <xf:if is="$person.User">
                                    <xf:avatar user="{$person.User}" size="xxs" />
                                    <xf:username user="{$person.User}" defaultname="{$person.username}" />
                                    <xf:else />-
                                </xf:if>
                            </xf:cell>
                            <xf:cell>
                                <xf:avatar user="{$person.CreatedByUser}" size="xxs" />
                                <xf:username user="{$person.CreatedByUser}"
                                    defaultname="{$person.created_by_username}" />
                            </xf:cell>
                            <xf:cell>
                                <xf:date time="{$person.created_date}" />
                            </xf:cell>
                            <xf:cell>
                                <xf:date time="{$person.last_update_date}" />
                            </xf:cell>
                            <xf:delete href="{{ link('ncmec-people/delete', $person) }}" />
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
            </div>

            <div class="block-footer block-footer--split">
                <span class="block-footer-counter">{{ display_totals($persons, $total) }}</span>
            </div>

            <xf:pagenav page="$page" perpage="$perPage" total="$total" link="ncmec-people" />
            <xf:else />
            <div class="block-body block-row">{{ phrase('no_results_found') }}</div>
        </xf:if>
    </div>
</div>]]></template>
  <template type="admin" title="usips_ncmec_person_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ $person.isInsert() ? phrase('usips_ncmec_add_person') : phrase('usips_ncmec_edit_person') }}</xf:title>

<xf:form action="{{ $person.isInsert() ? link('ncmec-people/create') : link('ncmec-people/update', $person) }}"
    ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:textboxrow name="first_name" value="{$person.first_name}" label="{{ phrase('usips_ncmec_first_name') }}"
                maxlength="100" />
            <xf:textboxrow name="last_name" value="{$person.last_name}" label="{{ phrase('usips_ncmec_last_name') }}"
                maxlength="100" />

            <xf:radiorow name="age_selector" value="{$ageSelectorValue}" label="{{ phrase('age') }}" required="false"
                explain="{{ phrase('usips_ncmec_age_selector_explain') }}">
                <xf:option value="none" label="{{ phrase('unknown') }}" />
                <xf:option value="date_of_birth" label="{{ phrase('date_of_birth') }}">
                    <xf:dependent>
                        <div class="inputGroup">
                            <xf:textbox name="date_of_birth" value="{$person.date_of_birth}" type="date" />
                        </div>
                    </xf:dependent>
                </xf:option>
                <xf:option value="age" label="{{ phrase('age') }}">
                    <xf:dependent>
                        <div class="inputGroup">
                            <xf:numberbox name="age" value="{{ $person.age !== null ? $person.age : '' }}" min="0"
                                step="1" />
                        </div>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>
        </div>

        <xf:submitrow icon="save" sticky="true" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_report_assign" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_add_to_report') }}</xf:title>

<xf:form action="{{ link('ncmec-reports/create') }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body">
            <xf:if is="$incidents.count() == 1">
				<xf:set var="$incident">{$incidents|first}</xf:set>
                <xf:formrow label="{{ phrase('usips_ncmec_incident') }}">
                    {{ $incident.title ?: phrase('usips_ncmec_untitled_incident') }}
                </xf:formrow>
                <xf:else />
                <xf:formrow label="{{ phrase('usips_ncmec_incidents') }}">
                    {{ phrase('usips_ncmec_x_incidents', {'count': $incidents.count()}) }}
                </xf:formrow>
            </xf:if>

            <xf:radiorow name="assignment_type" value="new" label="{{ phrase('usips_ncmec_report_assignment') }}">
                <xf:option value="new" label="{{ phrase('usips_ncmec_create_new_report') }}" />
                <xf:option value="existing" label="{{ phrase('usips_ncmec_add_to_existing_report') }}">
                    <xf:dependent>
                        <xf:if is="$availableReports.count()">
                            <xf:select name="existing_report_id">
                                <xf:foreach loop="$availableReports" value="$report">
                                    <xf:option value="{$report.report_id}">
                                        {{ phrase('usips_ncmec_report_x', {'id': $report.report_id}) }}
                                        ({{ phrase('created_by_x_on_y', {
                                        	'name': $report.username,
                                        	'date': date_dynamic($report.created_date)
                                        }) }})
                                    </xf:option>
                                </xf:foreach>
                            </xf:select>
                            <xf:else />
                            <div class="inputGroup-text">{{ phrase('usips_ncmec_no_open_reports') }}</div>
                        </xf:if>
                    </xf:dependent>
                </xf:option>
            </xf:radiorow>

            <xf:foreach loop="$incidentIds" value="$incidentId">
                <xf:hiddenval name="incident_ids[]" value="{$incidentId}" />
            </xf:foreach>
        </div>

        <xf:submitrow icon="save" submit="{{ phrase('usips_ncmec_add_to_report') }}" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_report_list" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_reports') }}</xf:title>

<div class="block">
    <div class="block-outer">
        <xf:macro template="filter_macros" name="quick_filter" arg-key="reports" arg-class="block-outer-opposite" />
    </div>
    <div class="block-container">
        <h2 class="block-tabHeader tabs hScroller" data-xf-init="h-scroller">
            <span class="hScroller-scroll">
                <xf:foreach loop="$tabs" key="$tabState" value="$tabLabel">
                    <a href="{{ link('ncmec-reports', null, {'state': $tabState}) }}"
                        class="tabs-tab {{ $tabState == $state ? 'is-active' : '' }}">{$tabLabel}</a>
                </xf:foreach>
            </span>
        </h2>
        <div class="block-body">
            <xf:if is="$reports is not empty">
                <xf:macro template="usips_ncmec_macros" name="report_list" arg-reports="{$reports}" />
                <xf:else />
                <div class="block-row">{{ phrase('no_results_found') }}</div>
            </xf:if>
        </div>
    </div>
    <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}" link="ncmec-reports"
        wrapperclass="block-outer block-outer--after" />
</div>]]></template>
  <template type="admin" title="usips_ncmec_report_step1" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_finalize_report') }} - {{ phrase('usips_ncmec_step_1_incident_summary') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-reports') }}">{{ phrase('usips_ncmec_reports') }}</xf:breadcrumb>
<xf:breadcrumb href="{{ link('ncmec-reports/view', $report) }}">{{ phrase('usips_ncmec_report') }} #{$report.report_id}
</xf:breadcrumb>

<xf:form action="{{ link('ncmec-reports/step-1', $report) }}" ajax="true" class="block">
    <div class="block-container">
        <h2 class="block-header">{{ phrase('usips_ncmec_step_1_incident_summary') }}</h2>
        <div class="block-body">
            <xf:selectrow name="incident_summary[incident_type]" value="{$report.incident_type}"
                label="{{ phrase('usips_ncmec_incident_type') }}"
                explain="{{ phrase('usips_ncmec_incident_type_explain') }}">
                <xf:option value=""></xf:option>
                <xf:foreach loop="$incidentTypeLabels" key="$value" value="$label">
                    <xf:option value="{$value}">{$label}</xf:option>
                </xf:foreach>
            </xf:selectrow>

            <xf:formrow label="{{ phrase('usips_ncmec_platform') }}"
                explain="{{ phrase('usips_ncmec_platform_explain') }}">
                <div class="inputGroup-text">
                    {{ $xf.options.boardTitle }}
                </div>
            </xf:formrow>

            <xf:checkboxrow name="incident_summary[report_annotations][]"
                label="{{ phrase('usips_ncmec_report_annotations') }}"
                explain="{{ phrase('usips_ncmec_report_annotations_explain') }}" listclass="listColumns">
                <xf:foreach loop="$annotationLabels" key="$value" value="$label">
                    <xf:option name="incident_summary[report_annotations][]" value="{$value}"
                        checked="{$report.isInReportAnnotations($value)}" label="{$label}" />
                </xf:foreach>
            </xf:checkboxrow>

            <xf:formrow label="{{ phrase('usips_ncmec_incident_date_time') }}"
                explain="{{ phrase('usips_ncmec_incident_date_time_explain') }}">
                <div class="inputGroup-text">
                    <xf:date time="{$earliestDateTime}" />
                </div>
            </xf:formrow>

            <xf:textarearow name="incident_summary[incident_date_time_desc]" value="{$report.incident_date_time_desc}"
                label="{{ phrase('usips_ncmec_incident_date_time_desc') }}"
                explain="{{ phrase('usips_ncmec_incident_date_time_desc_explain') }}" maxlength="3000" rows="4" />
        </div>
        <xf:submitrow submit="{{ phrase('continue') }}" icon="save" />
    </div>
</xf:form>]]></template>
  <template type="admin" title="usips_ncmec_report_view" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_report') }}</xf:title>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">{{ phrase('details') }}</h2>
        <div class="block-body">
            <xf:datalist class="dataList">
                <xf:datarow rowtype="header">
                    <xf:if is="$report.ncmec_report_id">
                        <xf:cell>{{ phrase('usips_ncmec_report_id') }}</xf:cell>
                    </xf:if>
                    <xf:cell>{{ phrase('created_by') }}</xf:cell>
                    <xf:cell>{{ phrase('usips_ncmec_reported_person') }}</xf:cell>
                    <xf:cell>{{ phrase('usips_ncmec_case') }}</xf:cell>
                    <xf:cell>{{ phrase('created') }}</xf:cell>
                    <xf:cell>{{ phrase('last_updated') }}</xf:cell>
                    <xf:cell>{{ phrase('status') }}</xf:cell>
                </xf:datarow>
                <xf:datarow>
                    <xf:if is="$report.ncmec_report_id">
                        <xf:cell>{$report.ncmec_report_id}</xf:cell>
                    </xf:if>
                    <xf:cell>
                        <xf:avatar user="{$report.User}" size="xxs" />
                        <xf:username user="{$report.User}" defaultname="{$report.username}" />
                    </xf:cell>
                    <xf:cell>
                        <xf:if is="$report.SubjectUser">
                            <xf:avatar user="{$report.SubjectUser}" size="xxs" />
                            <xf:username user="{$report.SubjectUser}" defaultname="{$report.subject_username}" />
                            <xf:else />
                            {$report.subject_username}
                        </xf:if>
                    </xf:cell>
                    <xf:cell>
                        <a href="{{ link('ncmec-cases/view', $report.Case) }}">
                            {{ $report.Case.title ?: phrase('usips_ncmec_untitled_case') }}
                        </a>
                    </xf:cell>
                    <xf:cell>
                        <xf:date time="{$report.created_date}" />
                    </xf:cell>
                    <xf:cell>
                        <xf:date time="{$report.last_update_date}" />
                    </xf:cell>
                    <xf:cell>
                        <xf:if is="$report.submitted_on">
                            {{ phrase('usips_ncmec_finalized') }}
                            <xf:else />
                            {{ phrase('usips_ncmec_draft') }}
                        </xf:if>
                    </xf:cell>
                </xf:datarow>
            </xf:datalist>
        </div>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">
            {{ phrase('usips_ncmec_incidents') }}
        </h2>
        <xf:if is="$incidents.count()">
            <div class="block-body">
                <xf:datalist class="dataList">
                    <xf:datarow rowtype="header">
                        <xf:cell>{{ phrase('title') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell>{{ phrase('date') }}</xf:cell>
                        <xf:cell>{{ phrase('status') }}</xf:cell>
                    </xf:datarow>
                    <xf:foreach loop="$incidents" value="$incident">
                        <xf:datarow>
                            <xf:cell class="dataList-cell--link">
                                <a href="{{ link('ncmec-incidents/view', $incident) }}">
                                    {{ $incident.title ?: phrase('usips_ncmec_untitled_incident') }}
                                </a>
                            </xf:cell>
                            <xf:cell>
                                <xf:avatar user="{$incident.User}" size="xxs" />
                                <xf:username user="{$incident.User}" />
                            </xf:cell>
                            <xf:cell>
                                <xf:date time="{$incident.created_date}" />
                            </xf:cell>
                            <xf:cell>
                                <xf:if is="$incident.finalized_on">
                                    {{ phrase('usips_ncmec_finalized') }}
                                    <xf:else />
                                    {{ phrase('usips_ncmec_draft') }}
                                </xf:if>
                            </xf:cell>
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ display_totals($incidents) }}</span>
            </div>
            <xf:else />
            <div class="block-body block-row">
                {{ phrase('usips_ncmec_no_incidents_in_report') }}
            </div>
        </xf:if>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <h2 class="block-header">
            {{ phrase('usips_ncmec_report_logs') }}
        </h2>
        <xf:if is="$apiLogs.count()">
            <div class="block-body">
                <xf:macro template="usips_ncmec_macros" name="api_log_list" arg-logs="{$apiLogs}" />
            </div>
            <div class="block-footer">
                <span class="block-footer-counter">{{ display_totals($apiLogs) }}</span>
            </div>
            <xf:else />
            <div class="block-body block-row">{{ phrase('no_results_found') }}</div>
        </xf:if>
    </div>
</div>]]></template>
  <template type="admin" title="usips_ncmec_user_batch_update_confirm" version_id="0" version_string="1.0.0"><![CDATA[<xf:form action="{{ link('users/batch-update/action') }}" class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('usips_ncmec_create_incident') }}</h2>
		<div class="block-body">
			<xf:checkboxrow>
				<xf:option name="actions[ncmec_incident]" required="{{ true }}">{{
					phrase('usips_ncmec_confirm_associating_x_users',
					{'total':
					$total|number}) }}</xf:option>
			</xf:checkboxrow>

			<xf:formrow label="{{ phrase('usips_ncmec_incident') }}">
				<xf:if is="$nonFinalizedIncidents is not empty">
					<xf:select name="incident_id">
						<xf:option value="">{{ phrase('usips_ncmec_create_incident') }}</xf:option>
						<xf:foreach loop="$nonFinalizedIncidents" value="$incident">
							<xf:option value="{$incident.incident_id}">{$incident.title} ({{
								date($incident.created_date) }})</xf:option>
						</xf:foreach>
					</xf:select>
					<xf:else />
					{{ phrase('usips_ncmec_new_incident_will_be_created') }}
				</xf:if>
			</xf:formrow>

			<xf:formrow label="{{ phrase('usips_ncmec_content_time_limit') }}"
						explain="{{ phrase('usips_ncmec_content_time_limit_explain') }}">
				<xf:select name="time_limit_seconds">
					<xf:option value="-1" selected="{{ $timeLimitSelection == -1 }}">{{ phrase('usips_ncmec_use_default_timespan', {'duration': $timeLimitDefaultDescription ?: phrase('all_time')}) }}</xf:option>
					<xf:option value="3600" selected="{{ $timeLimitSelection == 3600 }}">{{ phrase('1_hour') }}</xf:option>
					<xf:option value="86400" selected="{{ $timeLimitSelection == 86400 }}">{{ phrase('1_day') }}</xf:option>
					<xf:option value="172800" selected="{{ $timeLimitSelection == 172800 }}">{{ phrase('x_hours', {'count': 48}) }}</xf:option>
					<xf:option value="604800" selected="{{ $timeLimitSelection == 604800 }}">{{ phrase('1_week') }}</xf:option>
					<xf:option value="2592000" selected="{{ $timeLimitSelection == 2592000 }}">{{ phrase('1_month') }}</xf:option>
					<xf:option value="0" selected="{{ $timeLimitSelection == 0 }}">{{ phrase('all_time') }}</xf:option>
				</xf:select>
			</xf:formrow>
		</div>
		<xf:submitrow name="ncmec_incident" icon="attach" submit="{{ phrase('usips_ncmec_associate_users') }}" />
	</div>

	<xf:if is="$userIds">
		<xf:hiddenval name="user_ids">{$userIds|json}</xf:hiddenval>
		<xf:else />
		<xf:hiddenval name="criteria">{$criteria|json}</xf:hiddenval>
	</xf:if>
</xf:form>]]></template>
  <template type="public" title="alert_report_emergency" version_id="0" version_string="1.0.0"><![CDATA[{{ phrase('usips_ncmec_x_created_emregency_report_y', {
	'name': username_link($user, false, {'defaultname': $alert.username}),
	'title': '<a href="' . link('reports', $content) . '#report-comment-' . $alert.extra_data.comment.report_comment_id . '" class="fauxBlockLink-blockLink">' . $content.title . '</a>'
}) }}]]></template>
  <template type="public" title="usips_ncmec_approval_queue_macro_item_message_type" version_id="0" version_string="1.0.0"><![CDATA[<xf:set var="$attachmentMessage" value="{{ $content }}" />
<xf:set var="$attachments" value="null" />

<xf:if is="method_exists($content, 'hasRelation') && $content.hasRelation('Attachments') && $content.Attachments">
    <xf:set var="$attachments" value="{{ $content.Attachments }}" />
    <xf:elseif is="method_exists($content, 'hasRelation') && $content.hasRelation('FirstPost')" />
    <xf:set var="$firstPost" value="{{ $content.FirstPost }}" />
    <xf:if
        is="$firstPost && method_exists($firstPost, 'hasRelation') && $firstPost.hasRelation('Attachments') && $firstPost.Attachments">
        <xf:set var="$attachments" value="{{ $firstPost.Attachments }}" />
        <xf:set var="$attachmentMessage" value="{{ $firstPost }}" />
    </xf:if>
</xf:if>

<xf:if is="$attachments">
    <xf:macro id="message_macros::attachments" arg-attachments="{{ $attachments }}"
        arg-message="{{ $attachmentMessage }}" arg-canView="{{ true }}" />
</xf:if>]]></template>
  <template type="public" title="usips_ncmec_post_macros" version_id="0" version_string="1.0.0"><![CDATA[<xf:macro name="report_post" arg-post="!" arg-thread="!">
<xf:if is="$post.canReport()">
	<li>
		<a href="{{ link('posts/report', $post) }}"
		   class="message-attribution-gadget"
		   data-xf-click="overlay" data-cache="false" rel="nofollow">
			<xf:fa icon="fa-exclamation-triangle" />
		</a>
	</li>
</xf:if>
</xf:macro>]]></template>
  <template type="public" title="usips_ncmec_report_create" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('report_content') }}</xf:title>

<xf:form action="{$confirmUrl}" class="block" ajax="true" data-skip-overlay-redirect="true">

	<div class="block-container">
		<div class="block-body">
			<xf:radiorow name="report_type" value="standard" label="{{ phrase('usips_ncmec_report_type') }}"
				required="true" explain="{{ phrase('usips_ncmec_report_type_explain') }}">
				<xf:option value="standard" selected="true" label="{{ phrase('usips_ncmec_report_type_standard') }}">
					<xf:dependent>
						<div class="inputGroup">
							<xf:textarea name="message" autosize="true" autofocus="autofocus"
								placeholder="{{ phrase('report_reason') }}" />
						</div>
					</xf:dependent>
				</xf:option>
				<xf:option value="emergency" label="{{ phrase('usips_ncmec_report_type_emergency') }}" />
			</xf:radiorow>
		</div>
		<xf:submitrow submit="{{ phrase('report_verb') }}" />
	</div>
</xf:form>]]></template>
  <template type="public" title="usips_ncmec_report_state" version_id="0" version_string="1.0.0"><![CDATA[<xf:radiorow name="report_state" label="{{ phrase('status') }}">
	<xf:option value="" label="{{ phrase('do_not_change') }}" selected="true" />
	<xf:option value="assigned" label="{{ $report.report_state == 'assigned' ? phrase('unassign') : phrase('report_state.assigned') }}" />
	<xf:option value="resolved" label="{{ phrase('report_state.resolved') }}" />
	<xf:option value="rejected" label="{{ phrase('report_state.rejected') }}" />
	<xf:option value="flag_as_csam" label="{{ phrase('report_state.flag_as_csam') }}" />
</xf:radiorow>]]></template>
  <template type="public" title="usips_ncmec_report_step1" version_id="0" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('usips_ncmec_finalize_report') }} - {{ phrase('usips_ncmec_step_1_incident_summary') }}</xf:title>

<xf:breadcrumb href="{{ link('ncmec-reports') }}">{{ phrase('usips_ncmec_reports') }}</xf:breadcrumb>
<xf:breadcrumb href="{{ link('ncmec-reports/view', $report) }}">{{ phrase('usips_ncmec_report') }} #{$report.report_id}</xf:breadcrumb>

<xf:form action="{{ link('ncmec-reports/step-1', $report) }}" ajax="true" class="block">
    <div class="block-container">
        <h2 class="block-header">{{ phrase('usips_ncmec_step_1_incident_summary') }}</h2>
        <div class="block-body">
            <xf:selectrow name="incident_summary[incident_type]" 
                          value="{$report.incident_type}" 
                          label="{{ phrase('usips_ncmec_incident_type') }}"
                          explain="{{ phrase('usips_ncmec_incident_type_explain') }}">
                <xf:option value="">{{ phrase('please_select') }}...</xf:option>
                <xf:foreach loop="$incidentTypeLabels" key="$value" value="$label">
                    <xf:option value="{$value}">{$label}</xf:option>
                </xf:foreach>
            </xf:selectrow>

            <xf:formrow label="{{ phrase('usips_ncmec_platform') }}" explain="{{ phrase('usips_ncmec_platform_explain') }}">
                <div class="inputGroup-text">
                    {{ option('boardTitle') }}
                </div>
            </xf:formrow>

            <xf:checkboxrow name="incident_summary[report_annotations][]"
                            label="{{ phrase('usips_ncmec_report_annotations') }}"
                            explain="{{ phrase('usips_ncmec_report_annotations_explain') }}"
                            listclass="listColumns">
                <xf:foreach loop="$annotationLabels" key="$value" value="$label">
                    <xf:option name="incident_summary[report_annotations][]" 
                               value="{$value}"
                               checked="{$report.isInReportAnnotations($value)}"
                               label="{$label}" />
                </xf:foreach>
            </xf:checkboxrow>

            <xf:formrow label="{{ phrase('usips_ncmec_incident_date_time') }}" explain="{{ phrase('usips_ncmec_incident_date_time_explain') }}">
                <div class="inputGroup-text">
                    <xf:date time="{$earliestDateTime}" />
                </div>
            </xf:formrow>

            <xf:textboxrow name="incident_summary[incident_date_time_desc]"
                           value="{$report.incident_date_time_desc}"
                           label="{{ phrase('usips_ncmec_incident_date_time_desc') }}"
                           explain="{{ phrase('usips_ncmec_incident_date_time_desc_explain') }}"
                           maxlength="3000" />
        </div>
        <xf:submitrow submit="{{ phrase('save_and_continue') }}" icon="save" />
    </div>
</xf:form>]]></template>
</templates>
